#!/bin/sh

if [ "${BDK_ROOT}" = "" ]
then
    echo "The BDK_ROOT environment variable is not set"
    exit 1
fi

DIR=${BDK_ROOT}/target-bin

#
# Update the Lua filesystems in the images
#
# CN88XX
${BDK_ROOT}/bin/bdk-update-romfs ${DIR}/bdk-boot-cn88xx.bin ${DIR}/original/bdk-full-no-romfs.bin ${BDK_ROOT}/rom/full/*
${BDK_ROOT}/bin/bdk-update-romfs ${DIR}/bdk-chip-screen-cn88xx.bin ${DIR}/original/bdk-full-no-romfs.bin ${BDK_ROOT}/rom/chip-screen-cn88xx/*
${BDK_ROOT}/bin/bdk-update-romfs ${DIR}/bdk-network-perf-cn88xx.bin ${DIR}/original/bdk-full-no-romfs.bin ${BDK_ROOT}/rom/network-perf-cn88xx/*

#
# Create combined boot images for CN78XX
#
# CN88XX - BDK boot from NOR
cp ${DIR}/bdk-boot-cn88xx.bin ${DIR}/bdk-boot-nor-cn88xx.bin

# CN88XX - BDK boot from eMMC
cat ${DIR}/original/emm-boot.bin /dev/zero | dd of=${DIR}/bdk-boot-emmc-cn88xx.bin bs=1024 count=8 > /dev/null 2>&1
cat ${DIR}/bdk-boot-cn88xx.bin >> ${DIR}/bdk-boot-emmc-cn88xx.bin

# CN88XX - BDK boot from SPI
cat ${DIR}/original/spi-boot.bin /dev/zero | dd of=${DIR}/bdk-boot-spi-cn88xx.bin bs=1024 count=64 > /dev/null 2>&1
cat ${DIR}/bdk-boot-cn88xx.bin >> ${DIR}/bdk-boot-spi-cn88xx.bin

# CN88XX - Chip screen boot from NOR
# Already created above as the chip screen directly boots from NOR
