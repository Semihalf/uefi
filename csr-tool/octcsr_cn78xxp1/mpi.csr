# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: MPI
enums:
  - name: MPI_INTSN_E
    attributes:
      width: "20"
    description: Enumerates the different generated interrupts.
    values:
      - name: MPI_STS_INTR
        value: 0x05001
        description: See MPI_STS[MPI_INTR].


registers:
  - name: MPI_CFG
    title: MPI/SPI Configuration Register
    address: 0x1070000001000
    bus: NCB
    description: |
      This register provides configuration for the MPI/SPI interface. Note that some of the MPI/SPI
      pins are multiplexed with UART and BOOT pins.
      SPI_CK MPI/SPI clock; dedicated pin.
      SPI_DI MPI/SPI input; shared with UART0_DCD_L/SPI_DI; enabled when MPI_CFG[ENABLE]=1.
      SPI_DO MPI/SPI output; mux to UART0_DTR_L/SPI_DO; enabled when MPI_CFG[ENABLE]=1.
      SPI_CSn_L MPI/SPI output chip select; enabled when MPI_CFG[ENABLE]=1 and MPI_CFG[CSENAn]=1.
    fields:
      - name: --
        bits: 63..29
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: CLKDIV
        bits: 28..16
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Clock divisor.
          SPI_CK = coprocessor clock / (2 * CLKDIV)
          CLKDIV = coprocessor clock / (2 * SPI_CK)

      - name: CSENA3
        bits: 15
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CS3_L enable:
          0=UART1_RTS_L/SPI_CS3_L pin is UART pin.
          1=UART1_RTS_L/SPI_CS3_L pin is MPI/SPI pin.
          SPI_CS3_L drives UART1_RTS_L/SPI_CS3_L.

      - name: CSENA2
        bits: 14
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CS2_L enable:
          0=UART1_CTS_L/SPI_CS2_L pin is UART pin.
          1=UART1_CTS_L/SPI_CS2_L pin is MPI/SPI pin.
          SPI_CS2_L drives UART1_CTS_L/SPI_CS2_L.

      - name: CSENA1
        bits: 13
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CS1_L enable:
          0=BOOT_CE_N<7>/SPI_CS1_L pin is boot-bus pin.
          1=BOOT_CE_N<7>/SPI_CS1_L pin is MPI/SPI pin.
          SPI_CS1_L drives BOOT_CE_N<7>/SPI_CS1_L.

      - name: CSENA0
        bits: 12
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CS0_L enable:
          0=BOOT_CE_N<6>/SPI_CS0_L pin is boot-bus pin
          1=BOOT_CE_N<6>/SPI_CS0_L pin is MPI/SPI pin
          SPI_CS0_L drives BOOT_CE_N<6>/SPI_CS0_L.

      - name: CSLATE
        bits: 11
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CSn_L late.
          0 = SPI_CSn_L asserts 1/4 coprocessor-clock cycle before the transaction.
          1 = SPI_CSn_L asserts coincident with the transaction.

      - name: TRITX
        bits: 10
        access: R/W
        reset: 0
        typical: 0
        description: |
          Tristate TX. Used only when WIREOR = 1
          0 = SPI_DO pin is driven when slave is not expected to be driving.
          1 = SPI_DO pin is tristated when not transmitting.

      - name: IDLECLKS
        bits: 9..8
        access: R/W
        reset: 0x0
        typical: 0x0
        description: Idle clocks. When set, guarantees idle coprocessor-clock cycles between commands.

      - name: CSHI
        bits: 7
        access: R/W
        reset: 0
        typical: 0
        description: |
          SPI_CSn_L high: 1 = SPI_CSn_L is asserted high, 0 = SPI_CSn_L is asserted low.

      - name: --
        bits: 6..5
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: LSBFIRST
        bits: 4
        access: R/W
        reset: 0
        typical: 0
        description: |
          Shift LSB first: 0 = shift MSB first, 1 = shift LSB first.

      - name: WIREOR
        bits: 3
        access: R/W
        reset: 0
        typical: 0
        description: |
          Wire-OR DO and DI.
          0 = SPI_DO and SPI_DI are separate wires (SPI). SPI_DO pin is always driven.
          1 = SPI_DO/DI is all from SPI_DO pin (MPI). SPI_DO pin is tristated when not transmitting.
          If WIREOR = 1, SPI_DI pin is not used by the MPI/SPI engine.

      - name: CLK_CONT
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: |
          Clock control.
          0 = clock idles to value given by IDLELO after completion of MPI/SPI transaction.
          1 = clock never idles, requires SPI_CSn_L deassertion/assertion between commands.

      - name: IDLELO
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: |
          Clock idle low/clock invert.
          0 = SPI_CK idles high, first transition is high-to-low. This mode corresponds to SPI Block
          Guide options CPOL = 1, CPHA = 1.
          1 = SPI_CK idles low, first transition is low-to-high. This mode corresponds to SPI Block
          Guide options CPOL = 0, CPHA = 0.

      - name: ENABLE
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: |
          MPI/SPI enable.
          0 = UART0_DTR_L/SPI_DO, UART0_DCD_L/SPI_DI, UART1_CTS_L/SPI_CS2_L, UART1_RTS_L/SPI_CS3_L
          pins are UART pins.
          1 = UART0_DTR_L/SPI_DO and UART0_DCD_L/SPI_DI pins are MPI/SPI pins.
          UART1_CTS_L/SPI_CS2_L is an MPI/SPI pin if CSENA2 = 1
          UART1_RTS_L/SPI_CS3_L is an MPI/SPI pin if CSENA3 = 1


  - name: MPI_STS
    title: MPI/SPI STS Register
    address: 0x1070000001008
    bus: NCB
    fields:
      - name: --
        bits: 63..13
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: RXNUM
        bits: 12..8
        access: RO/H
        reset: 0x0
        typical: 0x0
        description: Number of bytes written for the transaction.

      - name: --
        bits: 7..2
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: MPI_INTR
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          MPI interrupt on transaction done. Throws MPI_INTSN_E::MPI_STS_INTR.

      - name: BUSY
        bits: 0
        access: RO/H
        reset: 0
        typical: 0
        description: |
          Busy.
          0 = no MPI/SPI transaction in progress.
          1 = MPI/SPI engine is processing a transaction.


  - name: MPI_TX
    title: MPI/SPI Transmit Register
    address: 0x1070000001010
    bus: NCB
    fields:
      - name: --
        bits: 63..22
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: CSID
        bits: 21..20
        access: WO
        reset: --
        typical: 0x0
        description: Which CS to assert for this transaction

      - name: --
        bits: 19..17
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: LEAVECS
        bits: 16
        access: WO
        reset: --
        typical: 0
        description: |
          Leave SPI_CSn_L asserted.
          0 = deassert SPI_CSn_L after the transaction is done.
          1 = leave SPI_CSn_L asserted after the transaction is done.

      - name: --
        bits: 15..13
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: TXNUM
        bits: 12..8
        access: WO
        reset: --
        typical: 0x1
        description: Number of bytes to transmit.

      - name: --
        bits: 7..5
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: TOTNUM
        bits: 4..0
        access: WO
        reset: --
        typical: 0x2
        description: Total number of bytes to shift (transmit and receive).


  - name: MPI_WIDE_DAT
    title: MPI/SPI Wide Data Register
    address: 0x1070000001040
    bus: NCB
    fields:
      - name: DATA
        bits: 63..0
        access: R/W/H
        reset: --
        typical: --
        description: Data to transmit/receive.


  - name: MPI_DAT(0..8)
    title: MPI/SPI Data Registers
    address: 0x1070000001080 + a*0x8
    bus: NCB
    fields:
      - name: --
        bits: 63..8
        access: --
        reset: --
        typical: --
        description: Reserved.

      - name: DATA
        bits: 7..0
        access: R/W/H
        reset: --
        typical: --
        description: Data to transmit/receive.



