# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: RST
enums:
  - name: RST_INTSN_E
    title: RST Interrupt Source Enumeration
    attributes:
      width: "20"
    description: Enumerates the different interrupts from RST.
    values:
      - name: RST_INT_LINK(0..3)
        value: 0x06000 + a
        description: See RST_INT[RST_LINK<a>].

      - name: RST_INT_PERST(0..3)
        value: 0x06008 + a
        description: See RST_INT[PERST<a>].


registers:
  - name: RST_BOOT
    title: RST Boot Register
    address: 0x1180006001600
    bus: RSL
    attributes:
      exempt_w1c_w: "True"
    fields:
      - name: CHIPKILL
        bits: 63
        access: R/W1S
        reset: 0
        typical: 0
        description: |
          A 0->1 transition of CHIPKILL starts the CHIPKILL timer. When CHIPKILL=1 and the timer
          expires, internal chip reset is asserted forever until the next chip reset. The CHIPKILL
          timer can be stopped only by a chip (cold, warm, soft) reset. The length of the CHIPKILL
          timer is specified by RST_CKILL[TIMER].

      - name: JTCSRDIS
        bits: 62
        access: R/W
        reset: --
        typical: 0
        description: |
          When set, internal CSR access via JTAG TAP controller is disabled This field resets to 1
          in Authentik mode, else 0.

      - name: EJTAGDIS
        bits: 61
        access: R/W
        reset: --
        typical: 0
        description: When set, external EJTAG access is disabled. This field resets to 1 in Authentik mode, else 0.

      - name: ROMEN
        bits: 60
        access: R/W
        reset: --
        typical: 0
        description: |
          When set, Authentik/eMMC boot ROM is visible in the boot bus address space. This field
          resets to 1 in an Authentik part or when booting from eMMC. Else, resets to 0.

      - name: CKILL_PPDIS
        bits: 59
        access: R/W
        reset: 1
        typical: --
        description: |
          When set, cores other than 0 are disabled during a CHIPKILL.  Writes have no effect when
          RST_BOOT[CHIPKILL]=1.

      - name: JT_TSTMODE
        bits: 58
        access: RO
        reset: --
        typical: --
        description: JTAG test mode.

      - name: VRM_ERR
        bits: 57
        access: RO
        reset: --
        typical: --
        description: |
          VRM did not complete operations within 5.25mS of DCOK being asserted. PLLs were released
          automatically.

      - name: --
        bits: 56..37
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: C_MUL
        bits: 36..30
        access: RO/H
        reset: --
        typical: --
        description: |
          Core-clock multiplier. C_MUL = (core-clock speed) / (ref-clock speed). 'ref-clock speed'
          should always be 50MHz.

      - name: PNR_MUL
        bits: 29..24
        access: RO/H
        reset: --
        typical: --
        description: |
          Coprocessor-clock multiplier. PNR_MUL = (coprocessor-clock speed) /(ref-clock speed).
          'ref-clock speed' should always be 50MHz.
          For PCIe Gen1, the coprocessor-clock speed must be greater than 250MHz; for PCIe Gen2, the
          coprocessor-clock speed must be greater than 500MHz; for PCIe Gen3, the coprocessor-clock
          speed must be greater than 800MHz.

      - name: --
        bits: 23..21
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: LBOOT_OCI
        bits: 20..18
        access: R/W1C
        reset: --
        typical: --
        description: |
          Last boot cause mask; resets only with DCOK.
          <20> Warm reset due to OCI Link 2 going down.
          <19> Warm reset due to OCI Link 1 going down.
          <18> Warm reset due to OCI Link 0 going down.

      - name: LBOOT_EXT
        bits: 17..12
        access: R/W1C
        reset: --
        typical: --
        description: |
          Last boot cause mask; resets only with DCOK.
          <17> Warm reset due to Cntl3 link-down or hot-reset.
          <16> Warm reset due to Cntl2 link-down or hot-reset.
          <15> Cntl3 reset due to PERST3_L pin.
          <14> Cntl2 reset due to PERST2_L pin.
          <13> Warm reset due to PERST3_L pin.
          <12> Warm reset due to PERST2_L pin.

      - name: LBOOT
        bits: 11..2
        access: R/W1C/H
        reset: --
        typical: --
        description: |
          Last boot cause mask; resets only with DCOK.
          <11> Soft reset due to watchdog.
          <10> Soft reset due to RST_SOFT_RST write.
          <9> Warm reset due to Cntl0 link-down or hot-reset.
          <8> Warm reset due to Cntl1 link-down or hot-reset.
          <7> Cntl1 reset due to PERST1_L pin.
          <6> Cntl0 reset due to PERST0_L pin.
          <5> Warm reset due to PERST1_L pin.
          <4> Warm reset due to PERST0_L pin.
          <3> Warm reset due to CHIP_RESET_L pin.
          <2> Cold reset due to PLL_DC_OK pin.

      - name: RBOOT
        bits: 1
        access: R/W
        reset: --
        typical: --
        description: Determines whether core 0 remains in reset after chip cold/warm/soft reset.

      - name: RBOOT_PIN
        bits: 0
        access: RO/H
        reset: --
        typical: --
        description: Read-only access to REMOTE_BOOT pin.


  - name: RST_DELAY
    title: RST Delay Register
    address: 0x1180006001608
    bus: RSL
    attributes:
      dv_fc_scratch: "ALL"
    fields:
      - name: --
        bits: 63..32
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: WARM_RST_DLY
        bits: 31..16
        access: R/W
        reset: 0x7ff
        typical: --
        description: |
          Warm reset delay. A warm reset immediately causes an early warm-reset notification, but
          the assertion of warm reset is delayed this many coprocessor-clock cycles. A warm/soft
          reset will not change this field.
          This must be at least 500 DCLK cycles.

      - name: SOFT_RST_DLY
        bits: 15..0
        access: R/W
        reset: 0x7ff
        typical: --
        description: |
          Soft reset delay. A soft reset immediately causes an early soft-reset notification, but
          the assertion of soft reset is delayed this many coprocessor-clock cycles. A warm/soft
          reset will not change this field.
          This must be at least 500 DCLK cycles.


  - name: RST_CFG
    title: RST Configuration Register
    address: 0x1180006001610
    bus: RSL
    fields:
      - name: BIST_DELAY
        bits: 63..6
        access: RO/H
        reset: --
        typical: --
        description: Reserved.

      - name: --
        bits: 5..3
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: CNTL_CLR_BIST
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: |
          Perform clear BIST during control-only reset, instead of a full BIST. A warm/soft reset
          will not change this field.

      - name: WARM_CLR_BIST
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: |
          Perform clear BIST during warm reset, instead of a full BIST. A warm/soft reset does not
          change this field. Note that a cold reset always performs a full BIST.

      - name: SOFT_CLR_BIST
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: |
          Perform clear BIST during soft reset, instead of a full BIST. A warm/soft reset does not
          change this field. Note that a cold reset always performs a full BIST.


  - name: RST_OCX
    title: RST OCX Register
    address: 0x1180006001618
    bus: RSL
    fields:
      - name: --
        bits: 63..3
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RST_LINK
        bits: 2..0
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Controls whether corresponding OCX link going down causes a chip reset. A warm/soft reset
          does not change this field. On cold reset, this field is initialized to 0.


  - name: RST_INT
    title: RST Interrupt Register
    address: 0x1180006001628
    bus: RSL
    fields:
      - name: --
        bits: 63..12
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: PERST
        bits: 11..8
        access: R/W1C/H
        reset: 0x0
        typical: --
        description: |
          PERST*_L asserted while RST_CTL*[RST_RCV] = 1 and RST_CTL*[RST_CHIP] = 0. One bit
          corresponds to each controller. Throws RST_INTSN_E::RST_INT_PERST(0..3).

      - name: --
        bits: 7..4
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RST_LINK
        bits: 3..0
        access: R/W1C/H
        reset: 0x0
        typical: --
        description: |
          A controller link-down/hot-reset occurred while RST_CTL*[RST_LINK] = 0. Software must
          assert then deassert RST_SOFT_PRST*[SOFT_PRST]. One bit corresponds to each controller.
          Throws RST_INTSN_E::RST_INT_LINK(0..3).


  - name: RST_CKILL
    title: RST Chipkill Timer Register
    address: 0x1180006001638
    bus: RSL
    fields:
      - name: --
        bits: 63..47
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: TIMER
        bits: 46..0
        access: R/W
        reset: 0x3ffffffff
        typical: --
        description: |
          Chipkill timer measured in SCLKs. Reads return current chipkill timer. Writes have no
          effect when RST_BOOT[CHIPKILL] = 1.


  - name: RST_CTL(0..3)
    title: RST Controllers Registers
    address: 0x1180006001640 + a*0x8
    bus: RSL
    fields:
      - name: --
        bits: 63..10
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: PRST_LINK
        bits: 9
        access: R/W
        reset: 0
        typical: --
        description: |
          Controls whether corresponding controller link-down or hot-reset causes the assertion of
          RST_SOFT_PRST*[SOFT_PRST].
          A warm/soft reset does not change this field. On cold reset, this field is initialized to
          0.

      - name: RST_DONE
        bits: 8
        access: RO/H
        reset: --
        typical: --
        description: |
          Read-only access to controller reset status. RST_DONE is always zero (i.e. the controller
          is held in reset) when:
          * RST_SOFT_PRST*[SOFT_PRST] = 1, or
          * RST_RCV = 1 and PERST*_L pin is asserted.

      - name: RST_LINK
        bits: 7
        access: R/W
        reset: --
        typical: --
        description: |
          Reset link. Controls whether corresponding controller link-down reset or hot reset causes
          a warm chip reset. On cold reset, this field is initialized as follows:
          0 when RST_CTL*[HOST_MODE] = 1
          1 when RST_CTL*[HOST_MODE] = 0
          Note that a link-down or hot-reset event can never cause a warm chip reset when the
          controller is in reset (i.e. can never cause a warm reset when RST_DONE = 0).

      - name: HOST_MODE
        bits: 6
        access: RO
        reset: --
        typical: --
        description: |
          Read-only access to the corresponding PEM(0..3)_CFG[HOSTMD] field indicating PEMn is root
          complex (host).
          For controllers 0 and 2 the inital value is determined by straps.  For controllers 1 and 3
          these field
          is initially set as host.

      - name: --
        bits: 5..4
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RST_DRV
        bits: 3
        access: R/W
        reset: --
        typical: --
        description: |
          Controls whether PERST*_L is driven. A warm/soft reset does not change this field. On cold
          reset, this field is initialized as follows:
          0 when RST_CTL*[HOST_MODE] = 0
          1 when RST_CTL*[HOST_MODE] = 1
          When set, CN78XX drives the corresponding PERST*_L pin. Otherwise, CN78XX does not drive
          the corresponding PERST*_L pin.

      - name: RST_RCV
        bits: 2
        access: R/W
        reset: --
        typical: --
        description: |
          Controls whether PERST*_L is received. A warm/soft reset will not change this field. On
          cold reset, this field is initialized as follows:
          0 when RST_CTL*[HOST_MODE] = 1
          1 when RST_CTL*[HOST_MODE] = 0
          When RST_RCV is equal to 1, the PERST*_L value is received and may be used to reset the
          controller and (optionally, based on RST_CHIP) warm reset the chip.
          When RST_RCV is equal to 1 (and RST_CHIP = 0), RST_INT[PERST*] gets set when the PERST*_L
          pin asserts. (This interrupt can alert software whenever the external reset pin initiates
          a controller reset sequence.)
          RST_VAL gives the PERST*_L pin value when RST_RCV = 1.
          When RST_RCV = 0, the PERST*_L pin value is ignored.

      - name: RST_CHIP
        bits: 1
        access: R/W
        reset: 0
        typical: --
        description: |
          Controls whether PERST*_L causes a chip warm reset like CHIP_RESET_L. A warm/soft reset
          will not change this field. On cold reset, this field is initialized to 0.
          When RST_RCV = 0, RST_CHIP is ignored.
          When RST_RCV = 1, RST_CHIP = 1, and PERST*_L asserts, a chip warm reset is generated.

      - name: RST_VAL
        bits: 0
        access: RO/H
        reset: --
        typical: --
        description: |
          Read-only access to PERST*_L. Unpredictable when RST_RCV = 0.
          Reads as 1 when RST_RCV is equal to 1 and the
          PERST*_L pin is asserted.
          Reads as 0 when RST_RCV = 1 and the PERST*_L pin is not asserted.


  - name: RST_SOFT_RST
    title: RST Soft Reset Register
    address: 0x1180006001680
    bus: RSL
    fields:
      - name: --
        bits: 63..1
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: SOFT_RST
        bits: 0
        access: WO
        reset: 0
        typical: --
        description: |
          When set, resets the CN78XX core. When performing a soft reset from a remote PCIe host,
          always read this register and wait for the results before setting SOFT_RST to 1.


  - name: RST_SOFT_PRST(0..3)
    title: RST PCIe Soft Reset Registers
    address: 0x11800060016C0 + a*0x8
    bus: RSL
    fields:
      - name: --
        bits: 63..1
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: SOFT_PRST
        bits: 0
        access: R/W
        reset: --
        typical: --
        description: |
          Resets the PCIe logic and corresponding common logic associated with the SLI controller in
          all modes, not just RC mode.
          * If the RST_CTL*[HOST_MODE] = 0, SOFT_PRST resets to 0.
          * If the RST_CTL*[HOST_MODE] = 1, SOFT_PRST resets to 1.
          When CN78XX is configured to drive PERST*_L (i.e.
          RST_CTL(0..3)[RST_DRV] = 1), this controls the output value on PERST*_L.


  - name: RST_PP_POWER
    title: RST Core Power Gating Control Register
    address: 0x1180006001700
    bus: RSL
    fields:
      - name: --
        bits: 63..48
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: GATE
        bits: 47..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Powerdown enable. When both a bit and the corresponding CIU3_PP_RST bit are set, the core
          has voltage removed to save power. In typical operation these bits are setup during
          initialization and PP resets are controlled through CIU3_PP_RST. These bits may only be
          changed when the corresponding core is in reset using CIU3_PP_RST.


  - name: RST_POWER_DBG
    title: RST Core Power Debug Control Register
    address: 0x1180006001708
    bus: RSL
    fields:
      - name: --
        bits: 63..3
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: STR
        bits: 2..0
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Reserved. INTERNAL: Internal power driver strength. Resets only on cold reset.



