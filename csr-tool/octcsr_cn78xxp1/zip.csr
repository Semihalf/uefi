# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: ZIP
enums:
  - name: ZIP_INTSN_E
    title: ZIP Interrupt Source Enumeration
    attributes:
      width: "20"
    description: Enumerates the different ZIP generated interrupts.
    values:
      - name: ZIP_ECCE_IQF_SBE
        value: 0x38000
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[IQF_SBE].

      - name: ZIP_ECCE_IQF_DBE
        value: 0x38001
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[IQF_DBE].

      - name: ZIP_ECCE_IDF_SBE
        value: 0x38002
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[IDF_SBE].

      - name: ZIP_ECCE_IDF_DBE
        value: 0x38003
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[IDF_DBE].

      - name: ZIP_ECCE_GPF_SBE
        value: 0x38004
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[GPF_SBE].

      - name: ZIP_ECCE_GPF_DBE
        value: 0x38005
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_ECCE_INT[GPF_DBE].

      - name: ZIP_FIFE_ASSERTS(0..53)
        value: 0x38040 + a
        attributes:
          cib_rtl_module: "zip"
        description: See ZIP_FIFE_INT[ASSERTS<a>].

      - name: ZIP_QUE(0..7)_DBL_OVF
        value: 0x38080 + a
        attributes:
          cib_rtl_module: "zip"
          intsn_lsb_mismatch: "True"
        description: See ZIP_QUE(0..7)_ERR_INT[DBL_OVF].

      - name: ZIP_QUE(0..7)_ECC_DBE
        value: 0x380C0 + a
        attributes:
          cib_rtl_module: "zip"
          intsn_lsb_mismatch: "True"
        description: See ZIP_QUE(0..7)_ERR_INT[ECC_DBE].


structs:
  - name: ZIP_ZPTR_S
    title: ZIP Generic Pointer (ZPTR) Structure
    description: ZPTR structures are the generic format of pointers in the ZIP instruction words (IWORD*).
    fields:
      - name: ADDR
        bits: 41..0
        description: |
          When a ZPTR is in an instruction word, ZPTR[ADDR] is either:
          A direct byte pointer into L2C/DDR attached memory, or
          A pointer to a gather/scatter list in memory.
          When a ZPTR is in a gather/scatter list, ZPTR[ADDR] is:
          A direct byte pointer into the attached memory.
          In case (b) above, and for context and result pointers, ZPTR[ADDR<2:0>] must be zero. (All
          these cases must be aligned on an 8 byte boundary.)
          In cases (a) or (c) above, ZPTR[ADDR] may be any byte alignment (except for context and
          result pointers).

      - name: --
        bits: 44..42
        description: Reserved, MBZ.

      - name: LE
        bits: 45
        description: |
          Little-endian. ZPTR[LE] may be set in case (a) or (c) above, indicating that ZPTR[ADDR]
          and the byte stream indicated by it is in little endian format.
          ZPTR[LE] must never be set in case (b) above, and must never be set for context or result
          pointers.

      - name: NC
        bits: 46
        description: |
          No cache allocation. ZPTR[NC] may be set in any case to indicate that the read/write
          operations generated should preferably not load cache blocks into the L2 cache.
          Note that in case (b) above, ZPTR[NC] indicates that the gather/scatter list should not be
          loaded into the cache. In cases (a) and (c) above, ZPTR[NC] indicates that the data or
          results should not be loaded into the L2 cache.
          Note that the ZIP hardware will ignore ZPTR[NC] for write operations when full cache
          blocks cannot be written.

      - name: FW
        bits: 47
        description: |
          Full-block write. ZPTR[FW] may be set in any case (a) or (c) where stores to ZPTR[ADDR]
          can be generated to indicate that the hardware may write random values into all bytes of
          all cache blocks touched by the range ADDR ... ADDR+ZPTR[LENGTH]-1.
          ZPTR[FW] must not be set in case (b) above, or whenever stores to ZPTR[ADDR] cannot
          possibly be generated.

      - name: LENGTH
        bits: 63..48
        description: |
          In case (a) and (c) under [ADDR], ZPTR[LENGTH] is the number of bytes pointed at by
          ZPTR[ADDR]. ZPTR[LENGTH] must be nonzero in this case.
          In case (b) under [ADDR], ZPTR[LENGTH] is the number of gather/ scatter list pointer
          entries pointed at by ADDR. (ZPTR[LENGTH]*8 is the number of bytes.) ZPTR[LENGTH] must be
          at least 2 in this case.
          ZPTR[LENGTH] must be zero for context and result pointers, because each has an implied
          fixed-size length (of ZIP_CONSTANTS[CTXSIZE] or fewer bytes and 24 bytes, respectively).


registers:
  - name: ZIP_CMD_CTL
    title: ZIP Clock/Reset Control Register
    address: 0x1180038000000
    bus: RSL
    description: This register controls clock and reset.
    fields:
      - name: --
        bits: 63..2
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: FORCECLK
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: When this bit is set to 1, it forces ZIP clocks on.

      - name: RESET
        bits: 0
        access: R/W1
        reset: 0
        typical: 0
        description: Reset one-shot pulse to reset ZIP subsystem.


  - name: ZIP_THROTTLE
    title: ZIP Throttle Register
    address: 0x1180038000010
    bus: RSL
    description: |
      This register controls the maximum number of in-flight X2I data fetch transactions. Writing 0
      to this register causes the ZIP module to temporarily suspend IOI accesses; it is not
      recommended for normal operation, but may be useful for diagnostics.
    fields:
      - name: --
        bits: 63..6
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: LD_INFL
        bits: 5..0
        access: R/W
        reset: 0x10
        typical: 0x10
        description: |
          Maximum number of in-flight data fetch transactions on the IOI.
          Larger values may improve ZIP performance but may starve other devices on the same IOI.
          Values > 32 are illegal.


  - name: ZIP_FIFE_INT
    title: ZIP Error Interrut Register
    address: 0x1180038000078
    bus: RSL
    fields:
      - name: --
        bits: 63..54
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ASSERTS
        bits: 53..0
        access: R/W1C/H
        reset: 0x0
        typical: 0x0
        description: |
          FIFO assertion checks. Throws ZIP_INTSN_E::ZIP_FIFE_ASSERT<n>.


  - name: ZIP_CONSTANTS
    title: ZIP Constants Register
    address: 0x11800380000A0
    bus: RSL
    description: |
      This register contains all of the current implementation-related parameters of the zip core in
      this chip.
    fields:
      - name: NEXEC
        bits: 63..56
        access: RO
        reset: 0x3
        typical: 0x3
        description: Number of available ZIP executive units. If zip is disabled, this field is 0.

      - name: --
        bits: 55..49
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: SYNCFLUSH_CAPABLE
        bits: 48
        access: RO
        reset: 1
        typical: 1
        description: |
          Sync flush supported: 1 = supported, 0 = not supported.

      - name: DEPTH
        bits: 47..32
        access: RO
        reset: 0x7c00
        typical: 0x7c00
        description: Maximum search depth for compression

      - name: ONFSIZE
        bits: 31..20
        access: RO
        reset: 0x200
        typical: 0x200
        description: Output near full threshold, in bytes

      - name: CTXSIZE
        bits: 19..8
        access: RO
        reset: 0x600
        typical: 0x600
        description: Decompression context size in bytes.

      - name: --
        bits: 7..1
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: DISABLED
        bits: 0
        access: RO
        reset: 0
        typical: 0
        description: Disable. 1 = ZIP is disabled, 0 = ZIP is enabled


  - name: ZIP_QUE_ENA
    title: ZIP Queue Enable Register
    address: 0x1180038000500
    bus: RSL
    description: If a queue is disabled, ZIP_CTL stops fetching instructions from the queue.
    fields:
      - name: --
        bits: 63..8
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ENA
        bits: 7..0
        access: R/W
        reset: 0xff
        typical: 0xff
        description: |
          Enables the logical instruction queues. Each bit corresponds to a queue:
          1 = queue is enabled.
          0 = queue is disabled.


  - name: ZIP_QUE_PRI
    title: ZIP Queue Priority Register
    address: 0x1180038000508
    bus: RSL
    description: This registers defines the priority between instruction queues.
    attributes:
      dv_fc_scratch: "ALL"
    fields:
      - name: --
        bits: 63..8
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: PRI
        bits: 7..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Queue priority. Each bit corresponds to a queue:
          PRI[n]=1: Queue n has higher priority. Round-Robin between higher priority queues.
          PRI[n]=0: Queue n has lower priority. Round-Robin between lower priority queues.


  - name: ZIP_CTL_BIST_STATUS
    title: ZIP Control Bist Status Register
    address: 0x1180038000510
    bus: RSL
    description: |
      This register has the BIST status of memories in ZIP_CTL (instruction buffer, G/S pointer
      FIFO, input data buffer, output data buffers). Each bit is the BIST result of an individual
      memory (per bit, 0 = pass and 1 = fail).
    attributes:
      dv_bist_all_fail_test: "ALL"
    fields:
      - name: --
        bits: 63..9
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BSTATUS
        bits: 8..0
        access: RO/H
        reset: X
        typical: 0x0
        description: BIST result of the memories


  - name: ZIP_CORE(0..2)_BIST_STATUS
    title: ZIP Core BIST Status Registers
    address: 0x1180038000520 + a*0x8
    bus: RSL
    description: |
      These register have the BIST status of memories in zip cores. Each bit is the BIST result of
      an individual memory (per bit, 0 = pass and 1 = fail).
    attributes:
      dv_bist_all_fail_test: "ALL"
    fields:
      - name: --
        bits: 63..53
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BSTATUS
        bits: 52..0
        access: RO/H
        reset: X
        typical: 0x0
        description: BIST result of the ZIP_CORE memories


  - name: ZIP_CTL_CFG
    title: ZIP Controller Configuration Register
    address: 0x1180038000560
    bus: RSL
    description: |
      This register controls the behavior of the ZIP DMA engines. It is recommended to keep default
      values for normal operation. Changing the values of the fields may be useful for diagnostics.
    fields:
      - name: --
        bits: 63..52
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ILDF
        bits: 51..48
        access: R/W
        reset: 0x8
        typical: 0x8
        description: Instruction Load Command FIFO credits <= 8

      - name: --
        bits: 47..43
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IPRF
        bits: 42..40
        access: R/W
        reset: 0x4
        typical: 0x4
        description: Instruction Page Return Command FIFO credits <= 4

      - name: --
        bits: 39..36
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IDTF
        bits: 35..32
        access: R/W
        reset: 0x8
        typical: 0x8
        description: Input Data Tag FIFOs (per core) credits <= 8

      - name: --
        bits: 31..27
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: STCF
        bits: 26..24
        access: R/W
        reset: 0x4
        typical: 0x4
        description: Store Command FIFO credits <= 4

      - name: --
        bits: 23..19
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: LDF
        bits: 18..16
        access: R/W
        reset: 0x4
        typical: 0x4
        description: Load Command FIFO credits <= 4

      - name: --
        bits: 15..11
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: WKQF
        bits: 10..8
        access: R/W
        reset: 0x4
        typical: 0x4
        description: WorkQueue FIFO credits <= 4

      - name: --
        bits: 7..2
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BUSY
        bits: 1
        access: RO/H
        reset: 0
        typical: --
        description: |
          1: ZIP system is busy; 0: ZIP system is idle.

      - name: LMOD
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: Legacy mode.


  - name: ZIP_ECC_CTL
    title: ZIP ECC Control Register
    address: 0x1180038000568
    bus: RSL
    description: |
      This register enables ECC for each individual internal memory that requires ECC. For debug
      purpose, it can also flip one or two bits in the ECC data.
    fields:
      - name: --
        bits: 63..11
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: GPF_CDIS
        bits: 10
        access: R/W
        reset: 0
        typical: 0
        description: G/S Pointer FIFO ECC correction disable.

      - name: GPF_FS
        bits: 9..8
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Controls G/S Pointer FIFO flip syndrome.
          00 = no error generation 10 = flip one bit
          01 = flip one bit 11 = flip two bits

      - name: --
        bits: 7
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IDF_CDIS
        bits: 6
        access: R/W
        reset: 0
        typical: 0
        description: Input Data FIFO ECC correction disable.

      - name: IDF_FS
        bits: 5..4
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Controls Input Data FIFO flip syndrome.
          00 = no error generation 10 = flip one bit
          01 = flip one bit 11 = flip two bits

      - name: --
        bits: 3
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IQF_CDIS
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: Instruction Queue FIFO ECC correction disable.

      - name: IQF_FS
        bits: 1..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Controls Instruction Queue FIFO flip syndrome.
          00 = no error generation 10 = flip one bit
          01 = flip one bit 11 = flip two bits


  - name: ZIP_ECCE_INT
    title: ZIP ECC Interrupt Status Register
    address: 0x1180038000578
    bus: RSL
    description: This register contains the status of the ECC interrupt sources.
    fields:
      - name: --
        bits: 63..6
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: GPF_DBE
        bits: 5
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          GPF double-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_GPF_DBE.

      - name: GPF_SBE
        bits: 4
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          GPF single-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_GPF_SBE.

      - name: IDF_DBE
        bits: 3
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          IDF double-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_IDF_DBE.

      - name: IDF_SBE
        bits: 2
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          IDF single-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_IDF_SBE.

      - name: IQF_DBE
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          IQF double-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_IQF_DBE.

      - name: IQF_SBE
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          IQF single-bit error. Throws ZIP_INTSN_E::ZIP_ECCE_IQF_SBE.


  - name: ZIP_DBG_CORE(0..2)_INST
    title: ZIP Core Current Instruction Registers
    address: 0x1180038000640 + a*0x8
    bus: RSL
    description: |
      These registers reflect the status of the current instruction that the ZIP core is executing
      or has executed. These registers are only for debug use.
    fields:
      - name: BUSY
        bits: 63
        access: RO/H
        reset: 0
        typical: --
        description: Core state. 0 = core is idle; 1 = core is busy.

      - name: --
        bits: 62..35
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: QID
        bits: 34..32
        access: RO/H
        reset: 0x0
        typical: --
        description: Queue index of instruction executed (BUSY = 0) or being executed (BUSY = 1) on this core.

      - name: IID
        bits: 31..0
        access: RO/H
        reset: 0x0
        typical: --
        description: Instruction index executed (BUSY = 0) or being executed (BUSY = 1) on this core.


  - name: ZIP_DBG_CORE(0..2)_STA
    title: ZIP Core Status Registers
    address: 0x1180038000680 + a*0x8
    bus: RSL
    description: These registers reflect the status of the zip cores and are for debug use only.
    fields:
      - name: BUSY
        bits: 63
        access: RO/H
        reset: 0
        typical: --
        description: Core state. 0 = core is idle; 1 = core is busy.

      - name: --
        bits: 62..37
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IST
        bits: 36..32
        access: RO/H
        reset: 0x0
        typical: --
        description: State of current instruction that is executing

      - name: NIE
        bits: 31..0
        access: RO/H
        reset: 0x0
        typical: --
        description: Number of instructions executed on this core


  - name: ZIP_QUE(0..7)_SBUF
    title: ZIP Queue Buffer Parameter Registers
    address: 0x1180038001000 + a*0x8
    bus: RSL
    description: |
      These registers set the buffer parameters for the instruction queues. When quiescent (i.e.
      outstanding doorbell count is 0), it is safe to rewrite this register to effectively reset the
      command buffer state machine.
    fields:
      - name: --
        bits: 63..61
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: SIZE
        bits: 60..48
        access: R/W
        reset: 0x0
        typical: 0x0
        description: Command-buffer size, in number of uint64 words per command buffer segment.

      - name: --
        bits: 47..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: PTR
        bits: 41..7
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: |
          Instruction buffer pointer bits <41:7> (128-byte aligned). When written, it is the initial
          buffer starting address; when read, it is the next read pointer to be requested from L2C.
          The PTR field is overwritten with the next pointer each time that the command buffer
          segment is exhausted. New commands will then be read from the newly specified command
          buffer pointer.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: ZIP_QUE(0..7)_AURA
    title: ZIP Queue Aura Registers
    address: 0x1180038001200 + a*0x8
    bus: RSL
    fields:
      - name: --
        bits: 63..12
        access: RAZ
        reset: --
        typical: --
        description: |
          Reserved. INTERNAL: For aura expansion.

      - name: AURA
        bits: 11..0
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Aura for returning command buffers for this queue. For best performance, the aura used
          should be on the local node.


  - name: ZIP_QUE(0..7)_MAP
    title: ZIP Queue Mapping Registers
    address: 0x1180038001400 + a*0x8
    bus: RSL
    description: These registers control how each instruction queue maps to zip cores.
    fields:
      - name: --
        bits: 63..3
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ZCE
        bits: 2..0
        access: R/W
        reset: 0x7
        typical: 0x7
        description: |
          Zip core enable. Controls the logical instruction queue can be serviced by which zip core.
          Setting ZCE to 0 effectively disables the queue from being served (however the instruction
          can still be fetched).
          ZCE<2> = 1: Zip core 2 can serve the queue.
          ZCE<1> = 1: Zip core 1 can serve the queue.
          ZCE<0> = 1: Zip core 0 can serve the queue.


  - name: ZIP_QUE(0..7)_ERR_INT
    title: ZIP Queue Error Status Registers
    address: 0x1180038001600 + a*0x8
    bus: RSL
    description: These registers contain the per-queue error interrupts.
    fields:
      - name: --
        bits: 63..2
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ECC_DBE
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          ECC double-bit error. Throws ZIP_INTSN_E::ZIP_QUE(0..7)_ECC_DBE.

      - name: DBL_OVF
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Doorbell overflow. Throws ZIP_INTSN_E::ZIP_QUE(0..7)_DBL_OVF.


  - name: ZIP_DBG_QUE(0..7)_STA
    title: ZIP Queue Status Registers
    address: 0x1180038001800 + a*0x8
    bus: RSL
    description: These registers reflect status of the zip instruction queues and are for debug use only.
    fields:
      - name: BUSY
        bits: 63
        access: RO/H
        reset: 0
        typical: --
        description: Queue state. 0 = queue is idle; 1 = queue is busy.

      - name: --
        bits: 62..52
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: CDBC
        bits: 51..32
        access: RO/H
        reset: 0x0
        typical: --
        description: Current doorbell counter

      - name: NII
        bits: 31..0
        access: RO/H
        reset: 0x0
        typical: --
        description: Number of instructions issued from this queue. Reset to 0 when ZIP_QUE(0..7)_SBUF is written.


  - name: ZIP_QUE(0..7)_GCFG
    title: ZIP Queue Generation Configuration Registers
    address: 0x1180038001A00 + a*0x8
    bus: RSL
    description: These registers reflect status of the zip instruction queues and are for debug use only.
    fields:
      - name: --
        bits: 63..4
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: IQB_LDWB
        bits: 3
        access: R/W
        reset: 1
        typical: 1
        description: |
          When set, reading a ZIP instruction full cache line will use IOI LDWB read-and-invalidate
          to improve performance. If clear, use IOI LDI for debugability. Partial cache line reads
          always use LDI.

      - name: CBW_STY
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: When set, a context cache block write will use STY. When clear, a context write will use STF.

      - name: L2LD_CMD
        bits: 1..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Which IOI load command to use for reading gather pointers, context, history and input
          data.
          0x0 = LDD.
          0x1 = LDI.
          0x2 = LDE.
          0x3 = LDY.



