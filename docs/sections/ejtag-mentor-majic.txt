Mentor Graphics Majic
~~~~~~~~~~~~~~~~~~~~~

Mentor Graphics Majic Software Version
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This guide was written using Mentor Grpahics software version 2.4c.

Setting the IP address for a Mentor Graphics Majic
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The setup for a Majic must be performed under Microsoft Windows.
Connect to the 9 pin serial port on the Majic with a straight through
serial cable.  Start the "MAJIC Setup Wizard".

image::images/mentor-setup-ip-1.png[Mentor MAJIC Setup Wizard part 1]

Click the "NEXT" button.

image::images/mentor-setup-ip-2.png[Mentor MAJIC Setup Wizard part 2]

Choose "Configure MAJIC's Ethernet Port" and click "NEXT".

image::images/mentor-setup-ip-3.png[Mentor MAJIC Setup Wizard part 3]

Choose RS-232 and set the port and speed.  The speed should be 115200.
Click "NEXT".

image::images/mentor-setup-ip-4.png[Mentor MAJIC Setup Wizard part 4]

Enter the IP address, subnet, and default gateway for the MAJIC.  Get
these from your IT department as the MAJIC is not capable of using
DHCP. Clock "Program IP Settings".

image::images/mentor-setup-ip-5.png[Mentor MAJIC Setup Wizard part 5]

After about 30 seconds the update will be complete. Select "Close" to terminate the setup wizard. You should now be able to ping the Majic.

[source,sh]
----
ping 192.168.111.231
----

This concludes the use of Microsoft Windows.  All other steps in this
guide are performed under the Linux host.

Starting the MDI GDB Server
^^^^^^^^^^^^^^^^^^^^^^^^^^^

In order to use the Majic probe with the BDK, you must have also
installed the OCTEON SDK.  The OCTEON SDK contains a GDB server for
Majic along with scripts to execute it.  It is recommended that you
follow the OCTEON SDK guide for installation as this document only
contains the minimal information needed to run EJTAG.

The Octeon SDK contains a minimal set of configuration files and Linux
binaries to support a GDB interface to the Majic.  These support files
are located in the "bin" and "cavium_minimal" directories.

Note: 	The binary files under the "bin" directory are originally from Mentor
	Graphics. These are packaged with the Octeon SDK to facilitate easy
	access to the Majic. To access the full capabilities of the Majic,
	install the Mentor Graphics support software.

The first step in using the Majic with the BDK is to
startup a MDI GDB server.  The script bin/mdi-gdbserver.sh simplifies this
quite a bit, so the SDK adds this to your default path as "mdi-gdbserver".
"mdi-gdbserver" takes two arguments.  The first argument is the IP address
or hostname of your Majic probe.  The second argument is the number of
cores supported by the OCTEON chip being debugged.  Once started, it is
unusual for you to need to restart the MDI server.  It is recommended you
start it in a separate Xterm and leave it minimized.  Here is an example
for a CN63XX connected to a Majic probe named "epi1".

[source,sh]
----
$ mdi-gdbserver epi1 6
Starting mdi-server.static for core 0 on port 8888
Starting mdi-server.static for core 1 on port 8889
Starting mdi-server.static for core 2 on port 8890
Starting mdi-server.static for core 3 on port 8891
Starting mdi-server.static for core 4 on port 8892
Starting mdi-server.static for core 5 on port 8893
Hit Control-C to kill MDI servers
----

Configuring the BDK Host tools to use the Majic
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The environment variable *OCTEON_REMOTE_PROTOCOL* controls how the
*bdk-remote* utility communicates with OCTEON.  Tot use the native
capabilities of the Macraigor mpDemon, this variable should be set as
follows:

[source, sh]
----
$ export OCTEON_REMOTE_PROTOCOL=gdb:localhost,8888
----

The different parts of this environment variable are defined below.

gdb::

This is the EJTAG protocol being used. For the Majic, this is the best
protocol.

localhost::

This is the hostname of the machine running mdi-gdb-server.

8888::

This is the TCP/IP port number used to connect to the MDI GDB server.

At this point all of the bdk-remote utilities are available.  Below is an
example of using "bdk-remote csr" to read an OCTEON CSR.

[source,sh]
----
$ bdk-remote csr CIU_FUSE
CIU_FUSE[0x0001070000000728] = 0x000000000000003f
  [63: 6] RESERVED_6_63        =          0 (0x0)
  [ 5: 0] FUSE                 =         63 (0x3f)
----

Booting the BDK
^^^^^^^^^^^^^^^

Now that the Majic is configured and the *OCTEON_REMOTE_PROTOCOL*
environment variable is set, the BDK can be booted on the board.  Issue
the following *bdk-remote* command.

[source, sh]
----
bdk-remote boot target-bin/bdk-boot.bin
----



