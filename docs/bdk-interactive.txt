
Interacting with the Bringup and Diagnostic Kit
===============================================

Overview
--------

The "Bringup and Diagnostic Kit" (BDK) is a set of executables and
scripts designed to ease the bringup of new hardware based on Cavium
Networks line of OCTEON processors.  This document covers the usage of
the BDK from an interactive console after the BDK has been installed.
For installation information, see the document link:bdk.html[Bringup and
Diagnostic Kit].

Navigating Menus and Answering Prompts
--------------------------------------

All menus in the BDK start with a banner followed by a list of
numbered options.  Options are chosen by typing the associated number
into the "Menu Choice:" prompt and pressing ENTER.  Leaving a prompt
blank signals that input should be aborted, passing control passes
back to the menu.  All menus have the last option as an exit of the
menu and return to the previous menu.

Some menu options require extra input from the user.  These accept
keyboard input followed by the ENTER key.  Leaving a field blank, or
hitting Control-C abort input.  Control goes back to the menu.
Numeric input can be in decimal (default) or hexadecimal by beginning
the number with "0x" (zero followed by "x", similar to the C
programming language).

Line Editing
~~~~~~~~~~~~

Any prompt ending with ">" supports full line editing and history. Generally
speaking, arrow keys, home, end, insert, and delete work as expected.

* Use 'ARROW KEYS', 'HOME', 'END' or *vi* style commands 'ESC-h', 'ESC-j', 'ESC-k', 'ESC-l', 'ESC-0', 'ESC-$', 'ESC-w', or 'ESC-b' for navigation.
* Scroll through previous commands using the 'UP' and 'DOWN' arrow keys.
* Use 'INSERT' to toggle insert/overwrite mode, 'DELETE' to delete, 'F1' for help.
* Many *vi* style modes are available for command and history navigation.
* Use 'TAB' for command completion, multiple to cycle, or 'CTRL-D' for a list of possible commands.
* Use 'ESC-i', 'ESC-A' ,'ESC-a', 'ESC-c' for insert mode, 'ESC-R', 'ESC-r' for overwrite mode (behavior like *vi*).
* Use '!!', '!<num>' or '!<string>' to repeat previous commands in the history.
* Use '::', ':<num>' or ':<string>' to recall previous commands in the history to current.
* Use '?<string>', '/<string>', 'ESC-?<string>', 'ESC-/<string>', 'ESC-n', 'ESC-N' to also recall to current.
* Use 'CTRL-l' erase the screen, 'ESC-D' to clear the rest of the current line.
* Use 'ESC-d<movement>' to delete, 'ESC-~' to change case, 'ESC-u' to undo (one level).
* See the *vi* man page for more info on the operation of various commands.

Getting started at the Main Menu
--------------------------------

After initial boot, the BDK displays the first, or main, menu.  This
provides a list of high level options that are available
interactively.  Most menu choices bringup sub menus of additional
options.

.Sample Main Menu
----
include::captures/main_menu.capture[]
----

Each menu option supports a logically distinct set of options:

Configuration options::

Use this option to configure the BDK for your board.  The specifics of
PHY addresses, MAC addresses, etc change for each board.  See
<<CONFIGURE, Configuring the BDK for your Board>>.

File options::

Here you'll find options for dealing with the BDK virtual filesystem.
These are normally most useful when writing scripts for the BDK.

Flash options::

Option for dealing with a NOR flash connected to chip select 0.

DDR options::

Options for configuring DDR3.

PCIe options::

PCIe discovery, enumeration, and probing can be accessed through this
menu. See <<PCIE, Testing PCIe>>.

TWSI options::

Scan or probe TWSI bus devices.

SMI/MDIO options::

Scan or probe SMI/MDIO bus devices.

Interactive Lua prompt::

This provides direct access to the Lua interpreter running in the BDK.
This can be used to probe and configure any type of hardware inside or
connected to OCTEON.  Scripting using Lua is cover in another
document.

TCP/IP networking::

The BDK contains a full TCP/IP stack with servers for TFTP and Telnet.
Use this menu option to configure an IP address on an OCTEON network
interface.

Traffic Generator::

This menu option starts a simple traffic generator on OCTEON.  It can
be used to transmit and receive packets on all OCTEON packet
interfaces.  In combination with an external loopback, this can
quickly verify the interfaces on a board.

Reboot::

Perform a soft reset of OCTEON.  This can be useful for a quick reboot
without power cycling the entire board.

[[CONFIGURE]]
Configuring the BDK for your Board
----------------------------------

include::sections/configure.txt[]


[[PCIE]]
Testing PCIe
------------

include::sections/pcie.txt[]


Testing DDR
-----------

include::sections/ddr.txt[]


Probing using TWSI
------------------

include::sections/twsi.txt[]


Probing using SMI / MDIO
------------------------

include::sections/mdio.txt[]


Generating Ethernet Traffic
---------------------------

include::sections/traffic-gen.txt[]


Access the BDK through Telnet
-----------------------------

The BDK contains a full TCP/IP stack with a builtin Telnet server.
The server is automatically started on boot, but is not accessible
until an IPv4 address is assigned to an Ethernet interface.  IPv4
addresses are controlled by the TCP/IP networking menu.  Once an IPv4
address is assigned, any Telnet client may connect to the BDK through
port 23, the standard Telnet port.

CAUTION: The builtin traffic generator interferes with TCP/IP.  If you
use TCP/IP, do not use the builtin traffic generator.  Using the
generator will disrupt TCP/IP and stop all connections.

.Sample TCP/IP Networking Menu
----
include::captures/tcp_menu.capture[]
----

Show all port configurations::

This option list all supported Ethernet devices and their current IPv4
configuration.

Configure MGMT0 with a static IP 10.0.0.2/24::

This option allows you to quickly assign a fixed IPv4 address to
management port 0.  This can be useful in a private network setup
where two machines are directly connected.  OCTEON will use 10.0.0.2,
while the host machine will likely use 10.0.0.1.  This option should
not be used on anything other than a small, private, test network.

Configure a network port with DHCP::

Use DHCP to automatically configure an Ethernet device.  A prompt will
ask for which interface to configure.  The valid options are shown in
the list for "Show all port configurations".

Configure a network port with a static IP::

Statically configure an Ethernet interface with pre determined IPv4
address.  Prompts will request the device to configure, the IP address
in dot notation, the netmask in dot notation, and the gateway in dot
notation.

Configure a network port with auto IP::

Dynamically assigns a local 169.254.*.* based on the zero
configuration method used by Microsoft Windows and Mac OS X.  This
address is suitable for private networks, but should normally not be
used on corporate LANs.  Note that configuring this method takes time
to perform a number of ARPs and wait for responses.  The resulting
address is not available for several seconds.


Access the BDK through TFTP
---------------------------

In addition to the builtin Telnet server, the BDK also contains a TFTP
server.  Once a valid IPv4 address is configured, the TFTP server can
be used to transfer files to and from the BDK.  Most any TFTP client
should work.  If you are running Linux, the recommended TFTP client is
HPA enhanced TFTP client.  For Debian systems, this can be installed
with:

.Installing a TFTP client on Debian
----
aptitude install tftp-hpa
----

.Sample TFTP transfer (OCTEON -> Host)
[source, sh]
----
tftp 169.254.1.240 -m binary -c get /rom/ilua.lua
----

.Sample TFTP transfer (Host -> OCTEON)
[source, sh]
----
tftp 169.254.1.240 -m binary -c put myscript.lua /ram/myscript.lua
----

