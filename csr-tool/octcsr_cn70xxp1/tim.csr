# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: TIM
registers:
  - name: TIM_REG_FLAGS
    address: 0x1180058000000
    bus: RSL
    internal: |
      TIM has a counter that causes a periodic tick every 1024 cycles. This counter is shared by all
      rings. (Each tick causes the HW to decrement the time offset (i.e. COUNT) for all enabled
      rings.)
      When ENA_TIM==0, the HW stops this shared periodic counter, so there are no more ticks, and
      there
      are no more new bucket traversals (for any ring).
      If ENA_TIM transitions 1->0, TIM will no longer create new bucket traversals, but there may
      have been previous ones. If there are ring bucket traversals that were already pending but
      not currently active (i.e. bucket traversals that need to be done by the HW, but haven't been
      yet)
      during this ENA_TIM 1->0 transition, then these bucket traversals will remain pending until
      ENA_TIM is later set to one. Bucket traversals that were already in progress will complete
      after the 1->0 ENA_TIM transition, though.
    fields:
      - name: --
        bits: 63..3
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: RESET
        bits: 2
        access: ---
        reset: 0
        typical: 0
        description: Reset oneshot pulse for free-running structures

      - name: ENA_DWB
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: |
          Enables non-zero DonwWriteBacks when set
          When set, enables the use of
          DontWriteBacks during the buffer freeing
          operations.

      - name: ENA_TIM
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: |
          Enables the TIM section when set
          When set, TIM is in normal operation.
          When clear, time is effectively stopped for all
          rings in TIM.


  - name: TIM_REG_READ_IDX
    address: 0x1180058000008
    bus: RSL
    internal: |
      Provides the read index during a CSR read operation to any of the CSRs that are physically
      stored
      as memories.  The names of these CSRs begin with the prefix "TIM_MEM_".
      IDX[7:0] is the read index.  INC[7:0] is an increment that is added to IDX[7:0] after any CSR
      read.
      The intended use is to initially write this CSR such that IDX=0 and INC=1.  Then, the entire
      contents of a CSR memory can be read with consecutive CSR read commands.
    fields:
      - name: --
        bits: 63..16
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: INC
        bits: 15..8
        access: R/W
        reset: 0x0
        typical: 0x0
        description: Increment to add to current index for next index

      - name: INDEX
        bits: 7..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: Index to use for next memory CSR read


  - name: TIM_REG_BIST_RESULT
    address: 0x1180058000080
    bus: RSL
    internal: |
      Access to the internal BiST results
      Each bit is the BiST result of an individual memory (per bit, 0=pass and 1=fail).
    fields:
      - name: --
        bits: 63..4
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: STA
        bits: 3..2
        access: RO
        reset: X
        typical: 0x0
        description: BiST result of the STA   memories (0=pass, !0=fail)

      - name: NCB
        bits: 1
        access: RO
        reset: X
        typical: 0
        description: BiST result of the NCB   memories (0=pass, !0=fail)

      - name: CTL
        bits: 0
        access: RO
        reset: X
        typical: 0
        description: BiST result of the CTL   memories (0=pass, !0=fail)


  - name: TIM_REG_ERROR
    address: 0x1180058000088
    bus: RSL
    internal: |
      A ring is in error if its interval has elapsed more than once without having been serviced.
      During a CSR write to this register, the write data is used as a mask to clear the selected
      mask
      bits (mask'[15:0] = mask[15:0] & ~write_data[15:0]).
    fields:
      - name: --
        bits: 63..16
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: MASK
        bits: 15..0
        access: R/W1C/H
        reset: 0x0
        typical: 0x0
        description: Bit mask indicating the rings in error


  - name: TIM_REG_INT_MASK
    address: 0x1180058000090
    bus: RSL
    internal: |
      Note that this CSR is present only in chip revisions beginning with pass2.
      When mask bit is set, the interrupt is enabled.
    fields:
      - name: --
        bits: 63..16
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: MASK
        bits: 15..0
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Bit mask corresponding to TIM_REG_ERROR.MASK above


  - name: TIM_MEM_RING0
    address: 0x1180058001000
    bus: RSL
    internal: |
      TIM_MEM_RING0 must not be written for a ring when TIM_MEM_RING1[ENA] is set for the ring.
      Every write to TIM_MEM_RING0 clears the current bucket for the ring. (The current bucket is
      readable via TIM_MEM_DEBUG2[BUCKET],TIM_MEM_DEBUG1[BUCKET].)
      BASE is a 32-byte aligned pointer[35:0].  Only pointer[35:5] are stored because pointer[4:0] =
      0.
      This CSR is a memory of 16 entries, and thus, the TIM_REG_READ_IDX CSR must be written before
      any
      CSR read operations to this address can be performed.
    fields:
      - name: --
        bits: 63..55
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: BASE
        bits: 54..24
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: |
          Pointer[35:5] to bucket[0]

      - name: BSIZE
        bits: 23..4
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Number of buckets - 1

      - name: RID
        bits: 3..0
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Ring ID


  - name: TIM_MEM_RING1
    address: 0x1180058001008
    bus: RSL
    internal: |
      After a 1->0 transition on ENA, the HW will still complete a bucket traversal for the ring
      if it was pending or active prior to the transition. (SW must delay to ensure the completion
      of the traversal before reprogramming the ring.)
      Every write to TIM_MEM_RING1 resets the current time offset for the ring to the INTERVAL
      value.
      (The current time offset for the ring is readable via TIM_MEM_DEBUG0[COUNT].)
      CSIZE must be at least 16.  It is illegal to program CSIZE to a value that is less than 16.
      This CSR is a memory of 16 entries, and thus, the TIM_REG_READ_IDX CSR must be written before
      any
      CSR read operations to this address can be performed.
    fields:
      - name: --
        bits: 63..43
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: ENA
        bits: 42
        access: R/W/H
        reset: 0
        typical: 0
        description: |
          Ring timer enable
          When clear, the ring is disabled and TIM
          will not traverse any new buckets for the ring.

      - name: CPOOL
        bits: 41..39
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Free list used to free chunks

      - name: CSIZE
        bits: 38..26
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Number of words per chunk

      - name: INTERVAL
        bits: 25..4
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Timer interval - 1, measured in 1024 cycle ticks

      - name: RID
        bits: 3..0
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Ring ID


  - name: TIM_MEM_DEBUG0
    address: 0x1180058001100
    bus: RSL
    internal: |
      Internal per-ring state intended for debug use only tim.ctl[47:0]
      This CSR is a memory of 16 entries, and thus, the TIM_REG_READ_IDX CSR must be written before
      any
      CSR read operations to this address can be performed.
    fields:
      - name: --
        bits: 63..48
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: ENA
        bits: 47
        access: RO/H
        reset: X
        typical: 0
        description: Ring timer enable

      - name: --
        bits: 46
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: COUNT
        bits: 45..24
        access: RO/H
        reset: X
        typical: 0x0
        description: |
          Time offset for the ring
          Set to INTERVAL and counts down by 1 every 1024
          cycles when ENA==1. The HW forces a bucket
          traversal (and resets COUNT to INTERVAL) whenever
          the decrement would cause COUNT to go negative.
          COUNT is unpredictable whenever ENA==0.
          COUNT is reset to INTERVAL whenever TIM_MEM_RING1
          is written for the ring.

      - name: --
        bits: 23..22
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: INTERVAL
        bits: 21..0
        access: RO/H
        reset: X
        typical: 0x0
        description: Timer interval - 1


  - name: TIM_MEM_DEBUG1
    address: 0x1180058001108
    bus: RSL
    internal: |
      Internal per-ring state intended for debug use only tim.sta[63:0]
      This CSR is a memory of 16 entries, and thus, the TIM_REG_READ_IDX CSR must be written before
      any
      CSR read operations to this address can be performed.
    fields:
      - name: BUCKET
        bits: 63..51
        access: RO/H
        reset: X
        typical: 0x0
        description: |
          Current bucket[12:0]
          Reset to 0 whenever TIM_MEM_RING0 is written for
          the ring. Incremented (modulo BSIZE) once per
          bucket traversal.
          See TIM_MEM_DEBUG2[BUCKET].

      - name: BASE
        bits: 50..20
        access: RO/H
        reset: X
        typical: 0x0
        description: |
          Pointer[35:5] to bucket[0]

      - name: BSIZE
        bits: 19..0
        access: RO/H
        reset: X
        typical: 0x0
        description: Number of buckets - 1


  - name: TIM_MEM_DEBUG2
    address: 0x1180058001110
    bus: RSL
    internal: |
      Internal per-ring state intended for debug use only tim.sta[95:64]
      This CSR is a memory of 16 entries, and thus, the TIM_REG_READ_IDX CSR must be written before
      any
      CSR read operations to this address can be performed.
    fields:
      - name: --
        bits: 63..24
        access: ---
        reset: --
        typical: --
        description: RESERVED

      - name: CPOOL
        bits: 23..21
        access: RO/H
        reset: X
        typical: 0x0
        description: Free list used to free chunks

      - name: CSIZE
        bits: 20..8
        access: RO/H
        reset: X
        typical: 0x0
        description: Number of words per chunk

      - name: --
        bits: 7
        access: RO/H
        reset: X
        typical: 0
        description: RESERVED

      - name: BUCKET
        bits: 6..0
        access: RO/H
        reset: X
        typical: 0x0
        description: |
          Current bucket[19:13]
          See TIM_MEM_DEBUG1[BUCKET].



