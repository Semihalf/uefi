# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: OSM
attributes:
  rtlgen_clock: "csclk"
  rtlgen_reset_n: "srst_d2_n"
enums:
  - name: ADDR_ERR_SOURCE_E
    attributes:
      width: "3"
    values:
      - name: "NONE"
        value: 3'h0
        description: No error logged.

      - name: DFA
        value: 3'h1
        description: DFA port address error (illegal bank).

      - name: HNA
        value: 3'h2
        description: HNA port address error (illegal bank).

      - name: TWC
        value: 3'h3
        description: TWC port address error (illegal bank).

      - name: BWC
        value: 3'h4
        description: BWC port address error (illegal bank).

      - name: RWC1
        value: 3'h5
        description: RWC1 port address error (illegal bank).

      - name: RWC2
        value: 3'h6
        description: RWC2 port address error (illegal bank).

      - name: RWC3
        value: 3'h7
        description: RWC3 port address error (illegal bank).


  - name: BANK_ASSIGN_E
    attributes:
      width: "3"
    values:
      - name: DISABLED
        value: 3'h0
        description: Bank disabled.

      - name: DFA
        value: 3'h1
        description: Bank assigned to DFA.

      - name: HNA
        value: 3'h2
        description: Bank assigned to HNA.

      - name: TWC
        value: 3'h3
        description: Bank assigned to ASE-TWC.

      - name: BWC
        value: 3'h4
        description: Bank assigned to ASE-BWC.

      - name: RWC
        value: 3'h5
        description: Bank assigned to ASE-RWC.


  - name: ECC_ERR_SOURCE_E
    attributes:
      width: "5"
    values:
      - name: "NONE"
        value: 5'h0
        description: No error logged.

      - name: DFA_SBE
        value: 5'h1
        description: DFA port single-bit error.

      - name: HNA_SBE
        value: 5'h2
        description: HNA port single-bit error.

      - name: TWC_SBE
        value: 5'h3
        description: TWC port single-bit error.

      - name: BWC_SBE
        value: 5'h4
        description: BWC port single-bit error.

      - name: RWC1_SBE
        value: 5'h5
        description: RWC1 port single-bit error.

      - name: RWC2_SBE
        value: 5'h6
        description: RWC2 port single-bit error.

      - name: RWC3_SBE
        value: 5'h7
        description: RWC3 port single-bit error.

      - name: HOST_SBE
        value: 5'h8
        description: Host port single-bit error.

      - name: DFA_DBE
        value: 5'h9
        description: DFA port double-bit error.

      - name: HNA_DBE
        value: 5'ha
        description: HNA port double-bit error.

      - name: TWC_DBE
        value: 5'hb
        description: TWC port double-bit error.

      - name: BWC_DBE
        value: 5'hc
        description: BWC port double-bit error.

      - name: RWC1_DBE
        value: 5'hd
        description: RWC1 port double-bit error.

      - name: RWC2_DBE
        value: 5'he
        description: RWC2 port double-bit error.

      - name: RWC3_DBE
        value: 5'hf
        description: RWC3 port double-bit error.

      - name: HOST_DBE
        value: 5'h10
        description: Host port double-bit error.


  - name: OSM_INTSN_E
    attributes:
      width: "20"
    values:
      - name: OSM_INT_STAT_DFA_DBE
        value: 0xDC000
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[DFA_DBE].

      - name: OSM_INT_STAT_DFA_SBE
        value: 0xDC001
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[DFA_SBE].

      - name: OSM_INT_STAT_HNA_DBE
        value: 0xDC002
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[HNA_DBE].

      - name: OSM_INT_STAT_HNA_SBE
        value: 0xDC003
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[HNA_SBE].

      - name: OSM_INT_STAT_TWC_DBE
        value: 0xDC004
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[TWC_DBE].

      - name: OSM_INT_STAT_TWC_SBE
        value: 0xDC005
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[TWC_SBE].

      - name: OSM_INT_STAT_BWC_DBE
        value: 0xDC006
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[BWC_DBE].

      - name: OSM_INT_STAT_BWC_SBE
        value: 0xDC007
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[BWC_SBE].

      - name: OSM_INT_STAT_RWC1_DBE
        value: 0xDC008
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC1_DBE].

      - name: OSM_INT_STAT_RWC1_SBE
        value: 0xDC009
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC1_SBE].

      - name: OSM_INT_STAT_RWC2_DBE
        value: 0xDC00A
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC2_DBE].

      - name: OSM_INT_STAT_RWC2_SBE
        value: 0xDC00B
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC2_SBE].

      - name: OSM_INT_STAT_RWC3_DBE
        value: 0xDC00C
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC3_DBE].

      - name: OSM_INT_STAT_RWC3_SBE
        value: 0xDC00D
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC3_SBE].

      - name: OSM_INT_STAT_HOST_DBE
        value: 0xDC00E
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[HOST_DBE].

      - name: OSM_INT_STAT_HOST_SBE
        value: 0xDC00F
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[HOST_SBE].

      - name: OSM_INT_STAT_DFA_ADDR_ERR
        value: 0xDC010
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[DFA_ADDR_ERR].

      - name: OSM_INT_STAT_HNA_ADDR_ERR
        value: 0xDC011
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[HNA_ADDR_ERR].

      - name: OSM_INT_STAT_TWC_ADDR_ERR
        value: 0xDC012
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[TWC_ADDR_ERR].

      - name: OSM_INT_STAT_BWC_ADDR_ERR
        value: 0xDC013
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[BWC_ADDR_ERR].

      - name: OSM_INT_STAT_RWC1_ADDR_ERR
        value: 0xDC014
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC1_ADDR_ERR].

      - name: OSM_INT_STAT_RWC2_ADDR_ERR
        value: 0xDC015
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC2_ADDR_ERR].

      - name: OSM_INT_STAT_RWC3_ADDR_ERR
        value: 0xDC016
        attributes:
          cib_rtl_module: "osm"
        description: See OSM_INT_STAT[RWC3_ADDR_ERR].


registers:
  - name: OSM_INT_STAT
    address: 0x11800DC000008
    bus: RSL
    description: |
      Interrupt Status.
      DBEs are detected. SBE's are corrected. For debugging output for ECC DBE/SBE's, see
      OSM_INT_INFO_ECC register.
      Address Errors happen when a requester attempts to access a bank that was not assigned to it.
      For example, Bank 0 is assigned to DFA and HNA attempts to access it. For debugging output for
      Address Errors, see OSM_INT_INFO_ADDR register. For current bank assignment, see
      OSM_BANK(0..63)_CTRL register.
    attributes:
      rtlgen_cib: "True"
    fields:
      - name: --
        bits: 63..23
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: RWC3_ADDR_ERR
        bits: 22
        access: R/W1C/H
        reset: 0
        typical: 0
        description: RWC3 port address error (illegal bank).

      - name: RWC2_ADDR_ERR
        bits: 21
        access: R/W1C/H
        reset: 0
        typical: 0
        description: RWC2 port address error (illegal bank).

      - name: RWC1_ADDR_ERR
        bits: 20
        access: R/W1C/H
        reset: 0
        typical: 0
        description: RWC1 port address error (illegal bank).

      - name: BWC_ADDR_ERR
        bits: 19
        access: R/W1C/H
        reset: 0
        typical: 0
        description: BWC port address error (illegal bank).

      - name: TWC_ADDR_ERR
        bits: 18
        access: R/W1C/H
        reset: 0
        typical: 0
        description: TWC port address error (illegal bank).

      - name: HNA_ADDR_ERR
        bits: 17
        access: R/W1C/H
        reset: 0
        typical: 0
        description: HNA port address error (illegal bank).

      - name: DFA_ADDR_ERR
        bits: 16
        access: R/W1C/H
        reset: 0
        typical: 0
        description: DFA port address error (illegal bank).

      - name: HOST_SBE
        bits: 15
        access: R/W1C/H
        reset: 0
        typical: 0
        description: Host port single bit error.

      - name: HOST_DBE
        bits: 14
        access: R/W1C/H
        reset: 0
        typical: 0
        description: Host port double bit error.

      - name: RWC3_SBE
        bits: 13
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC3 port single bit error.

      - name: RWC3_DBE
        bits: 12
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC3 port double bit error.

      - name: RWC2_SBE
        bits: 11
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC2 port single bit error.

      - name: RWC2_DBE
        bits: 10
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC2 port double bit error.

      - name: RWC1_SBE
        bits: 9
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC1 port single bit error.

      - name: RWC1_DBE
        bits: 8
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE RWC1 port double bit error.

      - name: BWC_SBE
        bits: 7
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE BWC port single bit error.

      - name: BWC_DBE
        bits: 6
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE BWC port double bit error.

      - name: TWC_SBE
        bits: 5
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE TWC port single bit error.

      - name: TWC_DBE
        bits: 4
        access: R/W1C/H
        reset: 0
        typical: 0
        description: ASE TWC port double bit error.

      - name: HNA_SBE
        bits: 3
        access: R/W1C/H
        reset: 0
        typical: 0
        description: HNA port single bit error.

      - name: HNA_DBE
        bits: 2
        access: R/W1C/H
        reset: 0
        typical: 0
        description: HNA port double bit error.

      - name: DFA_SBE
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: DFA port single bit error.

      - name: DFA_DBE
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: DFA port double bit error.


  - name: OSM_INT_INFO_ECC
    address: 0x11800DC000010
    bus: RSL
    description: |
      ECC error interrupt info.
      This register can be used to debug ECC failures. Fields are captured when there are no
      outstanding ECC errors indicated in OSM_INT_STAT register and a new ECC error arrives.
      Prioritization for multiple events occurring at the same time is indicated by the
      ECC_ERR_SOURCE_E enumeration: highest encoded value has highest priority. For current bank
      assignment, see OSM_BANK(0..63)_CTRL register.
    fields:
      - name: --
        bits: 63..37
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: ECC_ERR_SOURCE
        bits: 36..32
        access: RO/H
        reset: 0x0
        typical: --
        description: Source of ECC error, see OSM_ECC_ERR_SOURCE_E enumeration.

      - name: --
        bits: 31..16
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: ECC_ERR_ADDRESS
        bits: 15..0
        access: RO/H
        reset: 0x0
        typical: --
        description: RAM Address of the ECC error.


  - name: OSM_INT_INFO_ADDR
    address: 0x11800DC000018
    bus: RSL
    description: |
      Address error interrupt info.
      This register can be used to debug address errors (illegal bank). Fields are captured when
      there are no outstanding address errors indicated in OSM_INT_STAT register and a new address
      error arrives. Prioritization for multiple events occurring at the same time is indicated by
      the ADDR_ERR_SOURCE_E enumeration: highest encoded value has highest priority.
    fields:
      - name: --
        bits: 63..35
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR_ERR_SOURCE
        bits: 34..32
        access: RO/H
        reset: 0x0
        typical: --
        description: Source of address error, see OSM_ADDR_ERR_SOURCE_E enumeration.

      - name: --
        bits: 31..16
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR_ERR_ADDRESS
        bits: 15..0
        access: RO/H
        reset: 0x0
        typical: --
        description: RAM Address of the address error.


  - name: OSM_ECC_CTRL
    address: 0x11800DC000020
    bus: RSL
    description: ECC Control register.
    fields:
      - name: --
        bits: 63..3
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: FLIP_SYND
        bits: 2..1
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Flip the syndrom<1:0> bits to generate 1-bit/2-bits error for testing.
            0x0: normal operation.
            0x1: SBE on bit<0>.
            0x2: SBE on bit<1>.
            0x3: DBE on bit<1:0>.

      - name: COR_DIS
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: Disables SBE correction. SBE/DBE are still detected.


  - name: OSM_BANK(0..63)_CTRL
    address: 0x11800DC001000 + a*0x8
    bus: RSL
    fields:
      - name: --
        bits: 63..3
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: BANK_ASSIGN
        bits: 2..0
        access: R/W
        reset: 0x1
        typical: 0x1
        description: |
          See BANK_ASSIGN_E enumeration for encoding.
          Port assignment for each memory bank. Memory structure is
          64k words x 246 data bits (plus ECC). This is further
          divided into 64 banks each containing 1k words x 246 data bits.
          A bank can only support one access per cycle, this is implemented
          by assigning each bank to a specific requester. Most requesters can
          only make one request per cycle so that mostly solves the problem.
          RWC is the only requester that can make multiple requests per cycle
          and will need to implement its own bank-aware scheduler to prevent
          bank conflicts. Bank assignment can be reconfigured dynamically, but
          memory accesses to a bank must be quiesced before that bank can be
          reassigned to another requester. A host request can access any bank,
          arbitration logic will prevent bank conflicts for host requests.
          Addresses: bit<15:10> = bank, bit<9:0> = offset.
          bank0 corresponds to memory address 0x0000-0x03ff.
          bank1 corresponds to memory address 0x0400-0x07ff.
          bank63 corresponds to memory address 0xfc00-0xffff.
          See BANK_ASSIGN_E enumeration for encoding.


  - name: OSM_MEM(0..7)_BIST_STATUS
    address: 0x11800DC002000 + a*0x8
    bus: RSL
    description: |
      Built In Self Test Status Register.
      Results from BIST runs of OSM's memories.
      OSM_MEM is instantiated 8 times, each instance of OSM_MEM has its own BIST_STATUS
      register. Each OSM_MEM contains 32 BIST memory instances, so there are 32 status bits
      per register.
      Each BIST Memory Instance (1 BIST engine + multiple physical memories) contains
      2 physical memories, srf1024x32m8 and srf1024x33m3.
    fields:
      - name: --
        bits: 63..32
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: BIST_STATUS
        bits: 31..0
        access: RO/H
        reset: 0x0
        typical: 0x0
        description: BIST Status of BIST Memory Instance 31..0 in bits 31..0 respectively.


  - name: OSM_ASE_RATE_LIMIT_CTRL
    address: 0x11800DC002100
    bus: RSL
    fields:
      - name: --
        bits: 63..3
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: RWC_RATE_LIMIT
        bits: 2
        access: R/W
        reset: 1
        typical: 1
        description: |
          To support ASE running at SCLK/2, OSM can rate-limit
          responses sent back to ASE. Each request is assigned to either phase 0 or phase 1.
          When set, OSM will not send back-to-back responses for requests
          with the same phase. Instead a idle cycle will be inserted between the responses.
          This enable applies to RWC ports.

      - name: BWC_RATE_LIMIT
        bits: 1
        access: R/W
        reset: 1
        typical: 1
        description: |
          To support ASE running at SCLK/2, OSM can rate-limit
          responses sent back to ASE. Each request is assigned to either phase 0 or phase 1.
          When set, OSM will not send back-to-back responses for requests
          with the same phase. Instead a idle cycle will be inserted between the responses.
          This enable applies to BWC port.

      - name: TWC_RATE_LIMIT
        bits: 0
        access: R/W
        reset: 1
        typical: 1
        description: |
          To support ASE running at SCLK/2, OSM can rate-limit
          responses sent back to ASE. Each request is assigned to either phase 0 or phase 1.
          When set, OSM will not send back-to-back responses for requests
          with the same phase. Instead a idle cycle will be inserted between the responses.
          This enable applies to TWC port.



