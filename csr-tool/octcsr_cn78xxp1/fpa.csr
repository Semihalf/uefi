# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: FPA
enums:
  - name: FPA_INTSN_E
    title: FPA Interrupt Source Enumeration
    attributes:
      width: "20"
    description: Enumerates the different FPA generated interrupts.
    values:
      - name: FPA_ERR_CNT_ADD
        value: 0x28000
        description: See FPA_ERR_INT[CNT_ADD].

      - name: FPA_ERR_CNT_SUB
        value: 0x28001
        description: See FPA_ERR_INT[CNT_SUB].

      - name: FPA_ERR_HW_ADD
        value: 0x28002
        description: See FPA_ERR_INT[HW_ADD].

      - name: FPA_ERR_HW_SUB
        value: 0x28003
        description: See FPA_ERR_INT[HW_SUB].

      - name: FPA_ERR_RAM_SBE(0..19)
        value: 0x28040 + a
        description: See FPA_ECC_INT[RAM_SBE<a>].

      - name: FPA_ERR_RAM_DBE(0..19)
        value: 0x28060 + a
        description: See FPA_ECC_INT[RAM_DBE<a>].

      - name: FPA_POOL(0..63)_OVFLS
        value: 0x28800 + a
        attributes:
          intsn_lsb_mismatch: "True"
        description: |
          See FPA_POOL(0..63)_INT[OVFLS]. INTERNAL:

      - name: FPA_POOL(0..63)_CRCERR
        value: 0x28840 + a
        attributes:
          intsn_lsb_mismatch: "True"
        description: |
          See FPA_POOL(0..63)_INT[CRCERR]. INTERNAL:

      - name: FPA_POOL(0..63)_RANGE
        value: 0x28880 + a
        attributes:
          intsn_lsb_mismatch: "True"
        description: |
          See FPA_POOL(0..63)_INT[RANGE]. INTERNAL:

      - name: FPA_POOL(0..63)_THRESH
        value: 0x288C0 + a
        attributes:
          intsn_lsb_mismatch: "True"
        description: |
          See FPA_POOL(0..63)_INT[THRESH]. INTERNAL:

      - name: FPA_AURA(0..1023)_THRESH
        value: 0x29000 + a
        attributes:
          cib_rtl_module: "none"
          intsn_lsb_mismatch: "True"
        description: |
          See FPA_AURA(0..1023)_INT[THRESH]. INTERNAL:


structs:
  - name: FPA_ALLOC_IOBDMA_S
    title: FPA Allocate Operation IOBDMA Address Structure
    description: IOBDMA allocate-operation addresses are formed with this structure.
    fields:
      - name: --
        bits: 15..0
        attributes:
          const: "--"
        description: Reserved.

      - name: LAURA
        bits: 25..16
        attributes:
          const: "--"
        description: |
          Local node aura number. The aura<11:10> node number portion is assumed to be the node to
          which the operation is sent.

      - name: --
        bits: 34..26
        attributes:
          const: "--"
        description: Reserved.

      - name: RED
        bits: 35
        attributes:
          const: "--"
        description: Perform RED on allocation. See RED.

      - name: NODE
        bits: 39..36
        attributes:
          const: "--"
        description: OCI node number.

      - name: DID
        bits: 47..40
        attributes:
          const: "0x29"
        description: Device ID. Indicates FPA.

      - name: LEN
        bits: 55..48
        attributes:
          const: "0x1"
        description: |
          Length of return in words, must be one. If the pool has no available pointers in the
          selected pool (i.e. if [LEN] > FPA_POOL(0..63)_AVAILABLE), then the pointer returned for
          the IOBDMA operation are 0s, indicating that the pool does not have an adequate number of
          pointers to satisfy the IOBDMA.

      - name: SCRADDR
        bits: 63..56
        attributes:
          const: "--"
        description: CVMSEG LM address to return to. See IOBDMA Operations.


  - name: FPA_ALLOC_LD_S
    title: FPA Allocate Operation Load Address Structure
    description: Load Allocate operation addresses are formed with this structure.
    fields:
      - name: --
        bits: 15..0
        attributes:
          const: "--"
        description: Reserved.

      - name: LAURA
        bits: 25..16
        attributes:
          const: "--"
        description: |
          Local node aura number. The aura<11:10> node number portion is assumed to be the node to
          which the operation is sent.

      - name: --
        bits: 34..26
        attributes:
          const: "--"
        description: Reserved.

      - name: RED
        bits: 35
        attributes:
          const: "--"
        description: Perform RED on allocation. See RED.

      - name: NODE
        bits: 39..36
        attributes:
          const: "--"
        description: OCI node number.

      - name: DID
        bits: 47..40
        attributes:
          const: "0x29"
        description: Device ID. Indicates FPA.

      - name: IO
        bits: 48
        attributes:
          const: "1"
        description: Indicates I/O space.


  - name: FPA_ALLOC_RTN_S
    title: FPA Allocate Operation Return Structure
    description: Load and IOBDMA allocate operations return data specified by this structure.
    fields:
      - name: ADDR
        bits: 41..0
        description: |
          Address newly allocated by hardware. Bits <6:0> are always zero. If all zeroes, the
          selected pool is empty or RED was applied.

      - name: --
        bits: 63..42
        description: Reserved.


  - name: FPA_FREE_ADDR_S
    title: FPA Free Operation Address Structure
    description: Store Free operation addresses are formed with this structure.
    fields:
      - name: --
        bits: 2..0
        attributes:
          const: "--"
        description: Reserved. Provides 64-bit alignment.

      - name: DWB_COUNT
        bits: 11..3
        attributes:
          const: "--"
        description: |
          Number of cache lines for which the hardware (in IOB) should try to execute 'don't-write-
          back' commands. The hardware starts from the free operation's [ADDR] (i.e. to where the
          address points) and marches forward linearly for [DWB_COUNT] cache lines. As the DWB
          command can modify the value of memory locations, software must ensure that the maximum
          addressed DWB'd ([ADDR] + [DWB_COUNT] * 128 - 1) does not go past the end of the buffer
          being freed. As the DWB commands consume CMI bandwidth, software should keep the DWB_COUNT
          low to cover only those cache blocks that may have been modified.

      - name: --
        bits: 14..12
        attributes:
          const: "--"
        description: Reserved.

      - name: FABS
        bits: 15
        attributes:
          const: "--"
        description: Free absolute. See Core Requests.

      - name: LAURA
        bits: 25..16
        attributes:
          const: "--"
        description: |
          Local node aura number. The aura<11:10> node number portion is assumed to be the node to
          which the operation is sent.

      - name: --
        bits: 35..26
        attributes:
          const: "--"
        description: Reserved.

      - name: NODE
        bits: 39..36
        attributes:
          const: "--"
        description: |
          OCI node number. For a pointer allocated from a hardware block, the return the node number
          may be determined from bits <11:10> of the hardware provided aura.

      - name: DID
        bits: 47..40
        attributes:
          const: "0x29"
        description: Device Id. Indicates FPA.

      - name: IO
        bits: 48
        attributes:
          const: "1"
        description: Indicates I/O space.


  - name: FPA_FREE_DATA_S
    title: FPA Free Operation Data Structure
    description: Store Free operation data is formed with this structure.
    fields:
      - name: ADDR
        bits: 41..0
        description: |
          Address to return to pool. Bits <6:0> are ignored as buffers must be 128 byte aligned.

      - name: --
        bits: 63..42
        description: Reserved.


registers:
  - name: FPA_SFT_RST
    title: FPA Soft Reset Register
    address: 0x1280000000000
    bus: NCB
    description: Allows soft reset.
    fields:
      - name: BUSY
        bits: 63
        access: RO/H
        reset: 0
        typical: 0
        description: |
          When 1, FPA is busy completing reset. No access except the reading of this bit should
          occur to the FPA until this is clear.

      - name: --
        bits: 62..1
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RST
        bits: 0
        access: R/W1/H
        reset: 0
        typical: 0
        description: |
          Reset. When set to 1 by software, FPA gets a short reset pulse (three cycles in duration).
          Following a write to this register and prior to performing another FPA operation, software
          must write SSO_BIST_STATUS0 (or any register on the same IOI bus as FPA) and read it back.


  - name: FPA_ERR_INT
    title: FPA Error Interrupt Register
    address: 0x1280000000040
    bus: NCB
    description: This register contains the global (non-pool) error interrupt summary bits of the FPA.
    fields:
      - name: --
        bits: 63..4
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: HW_SUB
        bits: 3
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set when hardware does a subtract to the count that causes the counter to wrap. Throws
          FPA_INTSN_E::FPA_ERR_HW_SUB.

      - name: HW_ADD
        bits: 2
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set when hardware does an add to the count that causes the counter to wrap. Throws
          FPA_INTSN_E::FPA_ERR_HW_ADD.

      - name: CNT_SUB
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set when a write to FPA_AURA(0..1023)_CNT_ADD does a subtract to the count that causes the
          counter to wrap. Throws FPA_INTSN_E::FPA_ERR_CNT_SUB.

      - name: CNT_ADD
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set when a write to FPA_AURA(0..1023)_CNT_ADD does an add to the count that causes the
          counter to wrap. Throws FPA_INTSN_E::FPA_ERR_CNT_ADD.


  - name: FPA_GEN_CFG
    title: FPA Configuration Register
    address: 0x1280000000050
    bus: NCB
    description: This register provides FPA control and status information.
    fields:
      - name: --
        bits: 63..12
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: HALFRATE
        bits: 11
        access: R/W
        reset: 0
        typical: 0
        description: |
          Half rate. Limit peak alloc/free rate to half of peak to insure all alloc/frees are
          visible to OCLA.

      - name: OCLA_BP
        bits: 10
        access: R/W
        reset: 0
        typical: 0
        description: |
          OCLA backpressure enable. When OCLA FIFOs are near full, allow OCLA to backpressure
          alloc/frees. See also HALFRATE.

      - name: LVL_DLY
        bits: 9..4
        access: R/W
        reset: 0x0
        typical: 0x3
        description: |
          Levelizer delay. Number of cycles between level computations for backpressure and RED.
          Increasing values decrease power and leave additional bandwidth for allocate/deallocates.
          Zero disables, one indicates a level computation every other cycle, etc. Once set to
          nonzero must not be later set to zero without resetting FPA.

      - name: POOLS
        bits: 3..2
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Number of pools. Each halving of the number of pools doubles the buffering available to
          the remaining pools, leading to some improvement in memory bandwidth. Value must not be
          changed if FPA_POOL(0..63)_CFG[ENA] is set for any pool.
          0x0 = 64 pools, 320 FPF entries per pool.
          0x1 = 32 pools, 640 FPF entries per pool.
          0x2 = 16 pools, 1280 FPF entries per pool.
          0x3 = Reserved

      - name: AVG_EN
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: |
          QoS averaging enable. When set, compute average buffer levels, and [LVL_DLY] must be non-
          zero. When clear, do not compute averages and save a few mW of power.

      - name: CLK_OVERRIDE
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: Conditional clock override.


  - name: FPA_ECC_CTL
    title: FPA ECC Control Register
    address: 0x1280000000058
    bus: NCB
    description: This register allows inserting ECC errors for testing.
    fields:
      - name: --
        bits: 63..62
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RAM_FLIP1
        bits: 61..42
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Flip syndrome bits on write. Flip syndrome bits <1> on writes to the corresponding ram to
          test single-bit or double-bit error handling.

      - name: --
        bits: 41
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RAM_FLIP0
        bits: 40..21
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Flip syndrome bits on write. Flip syndrome bits <0> on writes to the corresponding ram to
          test single-bit or double-bit error handling.

      - name: --
        bits: 20
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RAM_CDIS
        bits: 19..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: RAM ECC correction disable. Each bit corresponds to a different RAM.


  - name: FPA_ECC_INT
    title: FPA ECC Interrupt Register
    address: 0x1280000000068
    bus: NCB
    description: This register contains ECC error interrupt summary bits.
    fields:
      - name: --
        bits: 63..52
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RAM_DBE
        bits: 51..32
        access: R/W1C/H
        reset: 0x0
        typical: 0x0
        description: |
          Set when a double-bit error is detected in the corresponding RAM. Throws
          FPA_INTSN_E::FPA_ECC_RAM_DBE.

      - name: --
        bits: 31..20
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: RAM_SBE
        bits: 19..0
        access: R/W1C/H
        reset: 0x0
        typical: 0x0
        description: |
          Set when a single-bit error is detected in the corresponding RAM. Throws
          FPA_INTSN_E::FPA_ECC_RAM_SBE.


  - name: FPA_BIST_STATUS
    title: BIST Status of FPA Memories Register
    address: 0x12800000000E8
    bus: NCB
    description: This register provides the result of the BIST run on the FPA memories.
    attributes:
      dv_bist_all_fail_test: "ALL"
    fields:
      - name: --
        bits: 63..38
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: STATUS
        bits: 37..0
        access: RO/H
        reset: 0x0
        typical: 0x0
        description: Memory BIST status.


  - name: FPA_CLK_COUNT
    title: FPA Clock Count Register
    address: 0x12800000000F0
    bus: NCB
    description: This register counts the number of coprocessor-clock cycles since the deassertion of reset.
    fields:
      - name: CLK_CNT
        bits: 63..0
        access: RO/H
        reset: --
        typical: --
        description: |
          Clock count. This counter is cleared to 0x0 when reset is applied and increments on every
          rising edge of the coprocessor clock.


  - name: FPA_RED_DELAY
    title: FPA RED Delay Register
    address: 0x1280000000100
    bus: NCB
    fields:
      - name: --
        bits: 63..14
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: AVG_DLY
        bits: 13..0
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Average-queue-size delay. The number of levelizer-clock cycles to wait (1024 *
          ([AVG_DLY]+1) * (FPA_GEN_CFG[LVL_DLY]+1)) coprocessor clocks) between calculating the
          moving average for each aura level. Note the minimum value of 2048 cycles implies that at
          100 M packets/sec, 1.2 GHz coprocessor clock, approximately 160 packets may arrive between
          average calculations.
          Larger FPA_GEN_CFG[LVL_DLY] values cause the backpressure indications and moving averages
          of all aura levels to track changes in the actual free space more slowly. Larger AVG_DLY
          also causes the moving averages of all aura levels to track changes in the actual free
          space more slowly, but does not affect backpressure. Larger
          FPA_AURA(0..1023)_CFG[AVG_CON]) values causes a specific aura to track more slowly, but
          only affects an individual aura level, rather than all.


  - name: FPA_ADDR_RANGE_ERROR
    title: FPA Address Range Error Information Register
    address: 0x1280000000458
    bus: NCB
    description: |
      When any FPA_POOL(0..63)_INT[RANGE] error occurs, this register is latched with additional
      error information.
    fields:
      - name: --
        bits: 63..54
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: POOL
        bits: 53..48
        access: RO/H
        reset: 0x0
        typical: --
        description: Pool that address was sent to.

      - name: --
        bits: 47..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..0
        access: RO/H
        reset: 0x0
        typical: --
        description: Failing address.


  - name: FPA_RD_REQ_PC
    title: FPA Read Request Perf-Count Register
    address: 0x1280000000600
    bus: NCB
    fields:
      - name: COUNT
        bits: 63..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: Number of L2C pool read requests.


  - name: FPA_RD_LATENCY_PC
    title: FPA Read Latency Perf-Count Register
    address: 0x1280000000610
    bus: NCB
    fields:
      - name: COUNT
        bits: 63..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          Number of cycles waiting for L2C pool read returns. This may be divided by FPA_RD_REQ_PC
          to determine the average read latency.


  - name: FPA_POOL(0..63)_CFG
    title: FPA Pool Configuration Registers
    address: 0x1280010000000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..43
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BUF_SIZE
        bits: 42..32
        access: R/W
        reset: 0x0
        typical: --
        description: Buffer size in cache lines. Only required if [NAT_ALIGN] is set.

      - name: --
        bits: 31
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BUF_OFFSET
        bits: 30..16
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          Number of cache lines to adjust returning pointers by. This field is sign extended so that
          two's complement numbers may be used to do subtractions. See Buffer Alignment.

      - name: --
        bits: 15..5
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: L_TYPE
        bits: 4..3
        access: R/W
        reset: 0x2
        typical: 0x2
        description: |
          Type of load to send to L2.
          0x0 = LDD.
          0x1 = LDT.
          0x2 = Load with DWB.
          0x3 = Reserved.

      - name: S_TYPE
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: |
          Type of store to use when sending pages to L2:
          0 = use STF.
          1 = use STT.

      - name: NAT_ALIGN
        bits: 1
        access: R/W
        reset: 0
        typical: 1
        description: |
          Returning buffers should be rounded to the nearest natural alignment specified with
          [BUF_SIZE]. See Buffer Alignment.

      - name: ENA
        bits: 0
        access: R/W
        reset: 0
        typical: 1
        attributes:
          regtest_force: "0"
        description: |
          Enable. Must be set after writing pool configuration, if clear any allocations will fail
          and returns will be dropped. If any pool configuration is changed after writing this bit,
          the FPA may operate incorrectly.


  - name: FPA_POOL(0..63)_FPF_MARKS
    title: FPA Pool Internal Read Write Marks Registers
    address: 0x1280010100000 | a<<3
    bus: NCB
    description: The low watermark register that determines when we read free pages from L2C.
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..27
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: FPF_RD
        bits: 26..16
        access: R/W
        reset: 0x100
        typical: --
        description: |
          When the number of free-page pointers in a pool drops below this value and there are free-
          page pointers in DRAM, the FPA reads one page of pointers from DRAM. The recommended value
          for this field is:
          fpf_sz * 0.75
          where, fpf_sz = 320 * 2^FPA_GEN_CFG[POOLS].
          The maximum value is fpf_sz - 48.
          It is recommended that software APIs represent this value as a percentage of fpf_sz, as
          fpf_sz may vary between products.
          INTERNAL: The worse case buffer requirement is:
          (memory_latency + 16 * (num_pools_active - 1) / cycles_per_alloc

      - name: --
        bits: 15..11
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: FPF_LEVEL
        bits: 10..0
        access: RO/H
        reset: 0x0
        typical: --
        description: The current number of free-page pointers in the pool, in entries. For diagnostic use.


  - name: FPA_POOL(0..63)_AVAILABLE
    title: FPA Pool Free Page Available Registers
    address: 0x1280010300000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..36
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: COUNT
        bits: 35..0
        access: RO/H
        reset: 0x0
        typical: 0x0
        description: |
          The number of free pages available in this pool. INTERNAL: Sized for 41 bit address - 7
          bit cache line


  - name: FPA_POOL(0..63)_THRESHOLD
    title: FPA's Pool Threshold Register
    address: 0x1280010400000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..36
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: THRESH
        bits: 35..0
        access: R/W
        reset: All-ones
        typical: 0x0
        description: |
          Threshold for the pool. When the value of FPA_POOL(0..63)_AVAILABLE[COUNT] is equal to
          [THRESH] and a pointer is allocated or freed, set interrupt
          FPA_INTSN_E::FPA_POOL(0..63)_THRESH.


  - name: FPA_POOL(0..63)_START_ADDR
    title: FPA's Pool Starting Address Registers
    address: 0x1280010500000 | a<<3
    bus: NCB
    description: Pointers sent to this pool after alignment must be equal to or greater than this address.
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..7
        access: R/W
        reset: 0x1
        typical: --
        description: Address. Defaults to 1 so that a NULL pointer free will cause an exception.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: FPA_POOL(0..63)_END_ADDR
    title: FPA's Pool Ending Address Registers
    address: 0x1280010600000 | a<<3
    bus: NCB
    description: Pointers sent to this pool after alignment must be equal to or less than this address.
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..7
        access: R/W
        reset: All-ones
        typical: --
        description: Address.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: FPA_POOL(0..63)_STACK_BASE
    title: FPA's Pool Stack Base Address Registers
    address: 0x1280010700000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..7
        access: R/W
        reset: 0x0
        typical: --
        description: Base address. The lowest address used by the pool's stack.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: FPA_POOL(0..63)_STACK_END
    title: FPA's Pool Stack End Registers
    address: 0x1280010800000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..7
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Stack ending address plus one line; hardware will never write this address. If
          FPA_POOL(0..63)_STACK_ADDR is equal to this value, the stack is full.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: FPA_POOL(0..63)_STACK_ADDR
    title: FPA's Pool Stack Last Address Registers
    address: 0x1280010900000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..42
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: ADDR
        bits: 41..7
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          Next address. The address of the next stack write. Must be initialized to
          FPA_POOL(0..63)_STACK_BASE[ADDR] when stack is createdFPA_POOL(0..63)_STACK_BASE.

      - name: --
        bits: 6..0
        access: RAZ
        reset: --
        typical: --
        description: Reserved.


  - name: FPA_POOL(0..63)_INT
    title: FPA Pool Interrupt Register
    address: 0x1280010A00000 | a<<3
    bus: NCB
    description: This register indicates pool interrupts.
    attributes:
      arch_max: "1024"
      min_stride: "65536"
    fields:
      - name: --
        bits: 63..4
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: THRESH
        bits: 3
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set and throws FPA_INTSN_E::FPA_POOL(0..63)_THRESH when FPA_POOL(0..63)_AVAILABLE is equal
          to FPA_POOL(0..63)_THRESHOLD and a pointer is allocated or deallocated.

      - name: RANGE
        bits: 2
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set and throws FPA_INTSN_E::FPA_POOL(0..63)_RANGE when a pointer address does not fall in
          the address range for that pool specified by FPA_POOL(0..63)_START_ADDR and
          FPA_POOL(0..63)_END_ADDR.

      - name: CRCERR
        bits: 1
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set and throws FPA_INTSN_E::FPA_POOL(0..63)_CRCERR when a page read from the DRAM contains
          inconsistent data (FPA ownership CRC does not match what FPA wrote). Most likely indicates
          the stack has been fatally corrupted.

      - name: OVFLS
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Set and throws FPA_INTSN_E::FPA_POOL(0..63)_OVFLS on stack overflow; when
          FPA_POOL(0..63)_STACK_ADDR would exceed FPA_POOL(0..63)_STACK_END.


  - name: FPA_POOL(0..63)_OP_PC
    title: FPA's Pool Operation Perf-Count Registers
    address: 0x1280010F00000 | a<<3
    bus: NCB
    attributes:
      arch_max: "1024"
      dv_fc_scratch: "a=(0)"
    fields:
      - name: COUNT
        bits: 63..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: Number of allocations or returns performed to this pool, including those that fail due to RED.


  - name: FPA_AURA(0..1023)_POOL
    title: FPA Aura to Pool Registers
    address: 0x1280020000000 | a<<3
    bus: NCB
    description: Provides the mapping from each aura to the pool number.
    attributes:
      arch_max: "65536"
    fields:
      - name: --
        bits: 63..6
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: POOL
        bits: 5..0
        access: R/W
        reset: 0x0
        typical: --
        description: Indicates which pool corresponds to each aura.


  - name: FPA_AURA(0..1023)_CFG
    title: FPA Aura Config Register
    address: 0x1280020100000 | a<<3
    bus: NCB
    description: This register configures aura backpressure, etc; see Aura Limits.
    fields:
      - name: --
        bits: 63..10
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: PTR_DIS
        bits: 9
        access: R/W
        reset: 0
        typical: 0
        description: |
          Disable aura tracking pointer allocates/returns.
          0 = When FPA allocates a pointer from this aura (including coprocessor or core requests),
          increment the count. When a pointer is returned to FPA for this aura (including
          coprocessor or core requests), decrement the count. Note that PKI may prefetch buffers it
          later returns, this may result in the count intermittently being higher than the number of
          buffers actually in use by packets visible to software.
          1 = Pointer allocations/returns will not automatically change the count.
          Note specific requests to change the count, including FPA_AURA(0..1023)_CNT_ADD,
          PKO_SEND_AURA_S, or PKI_AURA(0..1023)_CFG[PKT_ADD] will be applied regardless of the
          setting of this bit.

      - name: AVG_CON
        bits: 8..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          This value controls how much of each present average resource level is used to calculate
          the new resource level. The value is a number from 0 to 256, which represents AVG_CON/256
          of the average resource level that will be used in the calculation:
          next_LEVEL = (AVG_CON/256) * prev_LEVEL
          + (1-(AVG_CON/256)) * count
          Note setting this value to zero will disable averaging, and always use the most immediate
          levels. FPA_GEN_CFG[AVG_EN] must be set and FPA_GEN_CFG[LVL_DLY] must be nonzero to
          globally enable averaging. FPA_RED_DELAY[AVG_DLY] controls the periodicity of the level
          calculations.


  - name: FPA_AURA(0..1023)_CNT
    title: FPA Aura Count Register
    address: 0x1280020200000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: CNT
        bits: 39..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: The current aura count. See Aura Counts.


  - name: FPA_AURA(0..1023)_CNT_ADD
    title: FPA Aura Count Addition Register
    address: 0x1280020300000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: CNT
        bits: 39..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          The value to be added to FPA_AURA(0..1023)_CNT. The value may alternatively be a 2's
          complement of a value to be subtracted. Subtraction or addition that results in overflow
          will zero the count, not roll-around. See Aura Quality of Service.


  - name: FPA_AURA(0..1023)_CNT_LIMIT
    title: FPA Aura Allocation Limit Register
    address: 0x1280020400000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: LIMIT
        bits: 39..0
        access: R/W
        reset: all-ones
        typical: --
        description: |
          When FPA_AURA(0..1023)_CNT is equal to or greater than this value, any allocations using
          this aura will fail. This allows a hard resource division between multiple auras sharing a
          common pool.


  - name: FPA_AURA(0..1023)_CNT_THRESHOLD
    title: FPA Aura Count Threshold Register
    address: 0x1280020500000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: THRESH
        bits: 39..0
        access: R/W
        reset: all-ones
        typical: --
        description: |
          When FPA_AURA(0..1023)_CNT, after being modified, is equal to or crosses this value (i.e.
          value was greater than, then becomes less than, or the value was less than and becomes
          greater than) the corresponding bit in FPA_AURA(0..1023)_INT is set. See Aura Count
          Threshold Interrupts.


  - name: FPA_AURA(0..1023)_INT
    title: FPA Aura Interrupt Registers
    address: 0x1280020600000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..1
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: THRESH
        bits: 0
        access: R/W1C/H
        reset: 0
        typical: 0
        description: |
          Watermark interrupt pending. Set and throws FPA_INTSN_E::FPA_AURA(0..1024)_THRESH when
          FPA_AURA(0..1023)_INT, after being modified, is equal to or crosses
          FPA_AURA(0..1023)_CNT_THRESHOLD (i.e. value was greater than, then becomes less then, or
          value was less than, and becomes greater than). See Aura Count Threshold Interrupts.


  - name: FPA_AURA(0..1023)_POOL_LEVELS
    title: FPA Aura FPA Level Registers
    address: 0x1280020700000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BP_ENA
        bits: 39
        access: R/W
        reset: 0
        typical: 1
        description: Enable backpressure based on [BP] level. If set FPA_GEN_CFG[LVL_DLY] must be nonzero.

      - name: RED_ENA
        bits: 38
        access: R/W
        reset: 0
        typical: 1
        description: Enable RED based on [DROP] and [PASS] levels. If set FPA_GEN_CFG[LVL_DLY] must be nonzero.

      - name: SHIFT
        bits: 37..32
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Right shift to apply to FPA_POOL(0..63)_AVAILABLE to result in a 8-bit relative depth to
          be used for [DROP/PASS/LEVEL]. See Aura Counts.

      - name: BP
        bits: 31..24
        access: R/W
        reset: 0x0
        typical: --
        description: Backpressure will be indicated if the immediate shifted level is equal to or less than this value.

      - name: DROP
        bits: 23..16
        access: R/W
        reset: 0x0
        typical: --
        description: Packet will be dropped if the average shifted level is equal to or less than this value.

      - name: PASS
        bits: 15..8
        access: R/W
        reset: 0x0
        typical: --
        description: Packet will be passed if the average shifted level is larger than this value.

      - name: LEVEL
        bits: 7..0
        access: RO/H
        reset: 0x0
        typical: --
        description: |
          Current shifted level, averaged with FPA_POOL(0..63)_AVAILABLE[AVG_CON].
          FPA levels track availability; the higher the level the more free resources.


  - name: FPA_AURA(0..1023)_CNT_LEVELS
    title: FPA Aura Count Level Registers
    address: 0x1280020800000 | a<<3
    bus: NCB
    fields:
      - name: --
        bits: 63..40
        access: RAZ
        reset: --
        typical: --
        description: Reserved.

      - name: BP_ENA
        bits: 39
        access: R/W
        reset: 0
        typical: 1
        description: |
          Enable backpressure based on [BP] level. If set FPA_GEN_CFG[LVL_DLY] must be nonzero.
          PKI_AURA(0..1023)_CFG[ENA_BP] must also be set for backpressure to propagate through PKI.

      - name: RED_ENA
        bits: 38
        access: R/W
        reset: 0
        typical: 1
        description: |
          Enable RED based on [DROP] and [PASS] levels. If set FPA_GEN_CFG[LVL_DLY] must be nonzero.
          If set, RED is performed on core requests with FPA_ALLOC_LD_S[RED] set, and/or PKI
          requests if PKI_AURA(0..1023)_CFG[ENA_BP] is set.

      - name: SHIFT
        bits: 37..32
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Right shift to apply to FPA_AURA(0..1023)_CNT to result in a 8-bit relative depth to be
          used for [DROP/PASS/LEVEL]. See Aura Counts.

      - name: BP
        bits: 31..24
        access: R/W
        reset: 0x0
        typical: --
        description: Backpressure will be applied if the immediate shifted level is equal to or greater than this value.

      - name: DROP
        bits: 23..16
        access: R/W
        reset: 0x0
        typical: --
        description: Packet will be dropped if the average shifted level is equal to or greater than this value.

      - name: PASS
        bits: 15..8
        access: R/W
        reset: 0x0
        typical: --
        description: Packet will be passed if the average shifted level is less than this value.

      - name: LEVEL
        bits: 7..0
        access: RO/H
        reset: 0x0
        typical: --
        description: |
          Current shifted level, averaged with FPA_AURA(0..1023)_CNT.
          CNT levels track usage; the lower the level the more free resources.



