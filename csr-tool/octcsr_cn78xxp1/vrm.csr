# -*- csr3 -*-
# You must run "csr3 rtl" after editing this file!
---
name: VRM
structs:
  - name: VRM_TWS_TWSI_SW_S
    description: |
      SW write data to external regulator.
      VRM_TWS_TWSI_SW_S structure:
    fields:
      - name: DATA
        bits: 31..0
        description: Data to/from external regulator, includes PEC.

      - name: IA
        bits: 39..32
        description: Internal CSR address of registers within external regulator.

      - name: ADDR
        bits: 47..40
        description: Slave address. External regulator ID.

      - name: SIZE
        bits: 49..48
        description: Size of payload.

      - name: R
        bits: 50
        description: Read.

      - name: V
        bits: 51
        description: Valid.


registers:
  - name: VRM_TWS_TWSI_SW
    title: VRM TWSI to Software Register
    address: 0x118002100008
    bus: RSL
    description: |
      This register allows SW to write data into I2C Controller directly.
      This register is for diagnostic use only.
    fields:
      - name: V
        bits: 63
        access: RC/W/H
        reset: 0
        typical: --
        description: |
          Valid bit.
          Set on a write operation (should always be written with a 1).
          Cleared when a TWSI master-mode operation completes.
          Cleared when a TWSI configuration register access completes.
          Cleared when the TWSI device reads the register if SLONLY = 1.

      - name: SL_ONLY
        bits: 62
        access: RO
        reset: 0
        typical: 0
        description: Reserved.

      - name: EIA
        bits: 61
        access: RO
        reset: 0
        typical: 0
        description: Reserved.

      - name: OP
        bits: 60..57
        access: RO
        reset: 0x1
        typical: 0x1
        description: Reserved.

      - name: R
        bits: 56
        access: R/W/H
        reset: 0
        typical: --
        description: |
          Read bit or result. If this bit is set on a CSR write when SLONLY = 0, the operation is a
          read operation (if clear, it is a write operation).
          On a CSR read, this bit returns the result indication for the most recent master-mode
          operation, 1 = success, 0 = failure.

      - name: SOVR
        bits: 55
        access: RO
        reset: 1
        typical: 1
        description: Reserved.

      - name: SIZE_B3
        bits: 54
        access: RO
        reset: 0
        typical: 0
        description: Reserved.

      - name: SIZE
        bits: 53..52
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          Size minus one. Specifies the size in bytes of the master-mode operation.
          (0 = 1 byte, 1 = 2 bytes, 3 = 4 bytes).

      - name: SCR
        bits: 51..50
        access: RO
        reset: 0x0
        typical: 0x0
        description: Reserved.

      - name: UN_ADDR
        bits: 49..47
        access: RO
        reset: 0x0
        typical: 0x0
        description: Reserved.

      - name: ADDR
        bits: 46..40
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          Address field. The address of the remote device for a master-mode operation.
          Note that when mastering a 7-bit OP, ADDR<6:0> should not take any of the values 0x78,
          0x79, 0x7A nor 0x7B. (These 7-bit addresses are reserved to extend to 10-bit addressing).

      - name: IA
        bits: 39..32
        access: R/W/H
        reset: 0x0
        typical: 0x0
        description: Internal Address. Used when launching a combined master-mode operation.

      - name: DATA
        bits: 31..0
        access: R/W/H
        reset: 0x0
        typical: --
        description: |
          Data field.
          Used on a write operation when:
          Initiating a master-mode write operation (SLONLY = 0).
          Writing a TWSI configuration register (SLONLY = 0).
          The read value is updated by:
          A write operation to this register.
          Master-mode completion (contains error code).
          TWSI configuration-register read (contains result).


  - name: VRM_ALT_FUSE
    title: VRM Alternative Fuse Register
    address: 0x118002100018
    bus: RSL
    fields:
      - name: --
        bits: 63..40
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: TRAN_TEMP
        bits: 39..32
        access: R/W
        reset: 0x0
        typical: --
        description: Transition temperature for V calculation.

      - name: MAX_STEP
        bits: 31..24
        access: ---
        reset: --
        typical: --
        description: V step.

      - name: SLOPE
        bits: 23..16
        access: R/W
        reset: --
        typical: --
        description: Slope.

      - name: V_BASE
        bits: 15..8
        access: R/W
        reset: --
        typical: --
        description: Base voltage. Minimum voltage that gets written to voltage regulator.

      - name: V_MAX
        bits: 7..0
        access: R/W
        reset: --
        typical: --
        description: Max voltage. Maximum voltage that gets written to voltage regulator.


  - name: VRM_TELEMETRY_READ
    title: VRM Telemetry Read Register
    address: 0x118002100028
    bus: RSL
    fields:
      - name: --
        bits: 63..32
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: IOUT
        bits: 31..16
        access: RO
        reset: --
        typical: --
        description: Current reading from external regulator.

      - name: VOUT
        bits: 15..0
        access: RO
        reset: --
        typical: --
        description: Voltage reading from external regulator.


  - name: VRM_TELEMETRY_CMND
    title: VRM Telemetry Command Register
    address: 0x118002100038
    bus: RSL
    fields:
      - name: --
        bits: 63..2
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: CMND
        bits: 1..0
        access: R/W/H
        reset: --
        typical: --
        description: |
          This command will initiate a read instruction to the external voltage regulator
          into VRM_TELEMETRY_READ.
          00 .. Do nothing , 01/11 read V , 10 read I.
          Hardware clears CMND to indicate operation completed.


  - name: VRM_MISC_INFO
    title: VRM Miscellaneous Register
    address: 0x118002100048
    bus: RSL
    fields:
      - name: --
        bits: 63..40
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: VRM_CTL_RCV_STATUS_ERROR
        bits: 39..16
        access: RO/H
        reset: --
        typical: --
        description: Holds the recived status read from the external controller only for failing status.

      - name: VRM_CTL_CUR_STATE
        bits: 15..13
        access: RO/H
        reset: --
        typical: --
        description: Current state of the VRM_CTL.

      - name: VRM_TYPE
        bits: 12..11
        access: RO/H
        reset: --
        typical: --
        description: |
          VRM_TYPE identifies the type of device connected to the chip.
          00 : Linear type ,default or PMBus.
          01 : VID type , ISL6367

      - name: BOOT_SEQ
        bits: 10
        access: RO/H
        reset: --
        typical: --
        description: Boot sequence was completed.

      - name: TS_FUSE_STS
        bits: 9
        access: RO/H
        reset: --
        typical: --
        description: Set if VRM fuses were loaded.

      - name: VRM_FUSE_STS
        bits: 8
        access: RO/H
        reset: --
        typical: --
        description: Set if VRM fuses were loaded.

      - name: CMND
        bits: 7..0
        access: RO/H
        reset: --
        typical: --
        description: Last command send to the external voltage regulator.


  - name: VRM_TS_TEMP_CONV_CTL
    title: VRM Temp Sensor anlaog block alternate SW inputs
    address: 0x118002100058
    bus: RSL
    fields:
      - name: --
        bits: 63..13
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: RESET_SM
        bits: 12
        access: R/W
        reset: 0
        typical: --
        description: This will make the temp conversion SM to enter RST state.SM in RESET state,unitl RESET_SM cleared.

      - name: SW_ACCESS
        bits: 11
        access: R/W
        reset: 0
        typical: --
        description: If set, SW controls inputs of Analog Temp sensor.

      - name: TS_SWITCH
        bits: 10..2
        access: R/W
        reset: 0x14e
        typical: --
        description: These switches control temperature sensor,these provide alternate SW access.

      - name: TS_CURR2EN
        bits: 1
        access: R/W
        reset: 0
        typical: --
        description: Controls curr2_en pin on analog temperature sensor block.

      - name: STROBE
        bits: 0
        access: R/W
        reset: 0
        typical: --
        description: Controls strobe pin on analog temperature sensor block.


  - name: VRM_TS_TEMP_CONV_RESULT
    title: VRM Temp Sensor Result.
    address: 0x118002100068
    bus: RSL
    fields:
      - name: --
        bits: 63..24
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: N_VALID
        bits: 23
        access: RO/H
        reset: 0
        typical: --
        description: When set implies,N_VALUE is valid.

      - name: N_VALUE
        bits: 22..12
        access: RO/H
        reset: 0x0
        typical: --
        description: N cycle count values after calibration initiated. Qualified by N_VALID.

      - name: TEMP_VALID
        bits: 11
        access: RO/H
        reset: 0
        typical: --
        description: |
          When set implies,TEMP_CORRECTED is valid.
          This is not sticky and most likely SW will miss it.

      - name: TEMP_CORRECTED
        bits: 10..0
        access: RO/H
        reset: 0x0
        typical: --
        description: |
          Corrected temperature read out from the temp sensor module.
          Will always have valid data,once TEMP_VALID transitions.


  - name: VRM_TS_TEMP_CONV_COEFF_FSM
    title: VRM Temp Sensor Conversion routine coefficient and fsm ctl.
    address: 0x118002100078
    bus: RSL
    fields:
      - name: --
        bits: 63..58
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: T_FSM
        bits: 57..48
        access: R/W
        reset: 0xfa
        typical: --
        description: Sets time interval for FSM update.

      - name: --
        bits: 47..38
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: COEFF_A
        bits: 37..32
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Coefficient A value for polynomial fit.
          [37]   acts as a sign bit to flip the shifted results.
          [36:32] Bits dictate the amount of right shift.

      - name: --
        bits: 31..25
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: COEFF_B
        bits: 24..16
        access: R/W
        reset: 0x1
        typical: --
        description: |
          Coefficient B value for polynomial fit. It should be a positive number and between 1 and
          2.
          [24] is the integer part should always be 1.
          [23:16] form the fractional part.

      - name: --
        bits: 15..12
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: COEFF_C
        bits: 11..0
        access: R/W
        reset: 0x0
        typical: --
        description: |
          Coefficient C value for polynomial fit.
          A 2's complement number.


  - name: VRM_TS_TEMP_NOFF_MC
    title: VRM Temp Sensor, SW settable values for mc and noff.These would be used to bypass fused values
    address: 0x118002100088
    bus: RSL
    fields:
      - name: --
        bits: 63..28
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: MC
        bits: 27..16
        access: R/W
        reset: 0xbb8
        typical: --
        description: The MC value, default is 3000 decimal.

      - name: --
        bits: 15..11
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: NOFF
        bits: 10..0
        access: R/W
        reset: 0x0
        typical: 0x0
        description: |
          The N cycle count offset. It is used to subtract the appropriate count from N cycle.
          It should be such that at 0C, the difference between NOFF and NCYCLE would be 0.


  - name: VRM_FUSE_BYPASS
    title: Bypass the loaded fuses.
    address: 0x118002100098
    bus: RSL
    fields:
      - name: --
        bits: 63..3
        access: ---
        reset: --
        typical: --
        description: Reserved.

      - name: CTL_HW_BYPASS
        bits: 2
        access: R/W
        reset: 0
        typical: 0
        description: |
          If SET, will bypass VRM CTL, this HW is reponsible for controlling external voltage
          regulator.
          SW can then send commands to the regulator.

      - name: CTL_FUSE_BYPASS
        bits: 1
        access: R/W
        reset: 0
        typical: 0
        description: |
          If SET, will bypass fuses which feed the PMBus VRM CTL.
          Fuses that gets bypassed are v_max,v_base,max_step,slope,tran_temp.

      - name: TS_FUSE_BYPASS
        bits: 0
        access: R/W
        reset: 0
        typical: 0
        description: |
          If SET, will bypass fuses which feed the temperature sensor.
          Fuses bypassed with this are the MC and NOFF.



