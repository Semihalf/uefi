Macriagor Mpdemon or WiFiDemon
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Get the latest Firmware
^^^^^^^^^^^^^^^^^^^^^^^

Firmware and software updates are available for free from the Macraigor
website. Be sure the software installed meets the minimum version lists
below.

----
Model		Minimum Firmware
-----		----------------
mpDemon		3.0.4.3
WiFiDemon	2.3-0
----

Macraigor website::

link:http://www.macraigor.com/[]


Setting up a Macraigor mpDemon for use with Octeon
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Connect to the 9 pin serial port on the mpDemon with a straight through
serial cable. Using a baud rate of 19200, no parity, 8 bits, and 1 stop bit,
you should get the following menu after hitting return:

----
    Macraigor Systems mpDemon(tm) version 3.0.4.3

Licenses           :
API Baud Rate      : 115200
Use DHCP?          : Yes
DHCP Hostname      : mpdemon1
TCP/IP Address     : 192.168.162.166
       Mask        : 255.255.255.  0
       Gateway     : 192.168.162.  1
MAC Address        : 00.60.bf.01.01.b7
API TCP/IP Port    : 1000
OCDREMOTE          : JTAG speed 1
                   : JTAG TDO <- [1]CN63xx=8888 [2]CN63xx=8889 [3]CN63xx=8890 [4]CN63xx=8891 [5]CN63xx=8892 [6]CN63xx=8893 <- TDI

   mpDemon Command Menu:

  B - Set Serial API baud Rate             D - Set DHCP option
  N - Set DHCP hostName
  O - Set OCDREMOTE Configuration          T - Test OCDREMOTE Configuration
  L - Update License Code(s)               C - Set Macraigor API TCP/IP port
  P - Ping TCP/IP address                  J - Analyze JTAG Scan Chain
  E - Display Error Log                    R - Reboot mpDemon
  Type Command (<Enter> will refresh screen) ->
----

. Choose "D" to enable DHCP for the probe.
+
----
Type Command (<Enter> will refresh screen) -> D
Use DHCP? (Y/N) ->y
----

. Choose "N" to set the hostname that will be used during DHCP to name the
device. The following example configures the probe to use the name of
"mpdemon1".
+
----
Type Command (<Enter> will refresh screen) -> N
DHCP hostname ->mpdemon1

MUST REBOOT mpDEMON FOR DHCP CHANGE TO TAKE EFFECT
----

. Choose "O" to configure the builtin GDB remote stub. This is used to allow
interactive debugging using the GDB remote protocol. Again, the following
example is from a CN63XX.
+
----
  Type Command (<Enter> will refresh screen) -> O

Initial JTAG speed (1 - 8) [1] ->1
OCDREMOTE          : JTAG speed 1
                   : JTAG TDO <- [1]CN63xx=8888 [2]CN63xx=8889 [3]CN63xx=8890 [4]CN63xx=8891 [5]CN63xx=8892 [6]CN63xx=
8893 <- TDI
Do you want to change the JTAG chain [no]? y
Number of Devices in Scan Chain (0 - 16) [6] ->6
Device List:
            ...
            Cavium 64-bit Family:
              301x CN300x CN3020 CN31xx CN36xx
              CN38xx CN502X CN52xx CN56xx CN58xx
              CN63xx CN68xx N3 O1P O2P
              O9N O52 O56 O5020
            ...

Device1 [CN63xx] --> CN63xx
TCP/IP port number : [8888] ->

Device2 [CN63xx] --> CN63xx
TCP/IP port number : [8889] ->

Device3 [CN63xx] --> CN63xx
TCP/IP port number : [8890] ->

Device4 [CN63xx] --> CN63xx
TCP/IP port number : [8891] ->

Device5 [CN63xx] --> CN63xx
TCP/IP port number : [8892] ->

Device6 [CN63xx] --> CN63xx
TCP/IP port number : [8893] ->
   Reboot mpDemon to run with new parameters
   hit any key to continue
----

. At this time, configuration is complete. Reboot the probe with the "R" command
and view the new configuration.
+
----
  Type Command (<Enter> will refresh screen) -> r
Are you sure you want to reboot? y
Rebooting...
OK

    Macraigor Systems mpDemon(tm) version 3.0.4.3

Licenses           :
API Baud Rate      : 115200
Use DHCP?          : Yes
DHCP Hostname      : mpdemon1
TCP/IP Address     : 192.168.162. 53
       Mask        : 255.255.255.  0
       Gateway     : 192.168.162.  1
MAC Address        : 00.60.bf.01.01.b7
API TCP/IP Port    : 1000
OCDREMOTE          : JTAG speed 1
                   : JTAG TDO <- [1]CN63xx=8888 [2]CN63xx=8889 [3]CN63xx=8890 [4]CN63xx=8891 [5]CN63xx=8892 [6]CN63xx=
8893 <- TDI

   mpDemon Command Menu:

  B - Set Serial API baud Rate             D - Set DHCP option
  N - Set DHCP hostName
  O - Set OCDREMOTE Configuration          T - Test OCDREMOTE Configuration
  L - Update License Code(s)               C - Set Macraigor API TCP/IP port
  P - Ping TCP/IP address                  J - Analyze JTAG Scan Chain
  E - Display Error Log                    R - Reboot mpDemon
  Type Command (<Enter> will refresh screen) ->
----

Setting up a Macraigor WiFiDemon for use with Octeon
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

After booting, the WiFiDemon should be ready for use. The probe
automatically starts the EJTAG software listening on port 1000.
Configuration of the WiFiDemon is done either through serial,
direct keyboard/mouse connection, or through VNC.

Configuring the BDK Host tools to use the mpDemon or WiFiDemon
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The environment variable *OCTEON_REMOTE_PROTOCOL* controls how the
*bdk-remote* utility communicates with OCTEON.  Tot use the native
capabilities of the Macraigor probes, this variable should be set as
follows:

[source, sh]
----
export OCTEON_REMOTE_PROTOCOL=macraigor:mpdemon1,1000,1
----

The different parts of this environment variable are defined below.

macraigor::

This is the EJTAG protocol being used. For the mpDemon and WiFiDemon,
this is the best protocol.

mpdemon1::

This is the hostname of the mpDemon.  You can either use a name or
IPv4 address in X.X.X.X format.

1000::

This is the TCP/IP port number used to connect to the mpDemon.  This
matches the "API TCP/IP Port" configuration of the probe.  The default
port is '1000' for Macarigor probes.

1::

This is the EJTAG clock speed divider.  Generally the fastest speed of
'1' is best.  If you have trouble, try increasing this value to '2' or
'3'.  If trouble persists, try '8'.

Booting the BDK
^^^^^^^^^^^^^^^

Now that the probe is configured and the *OCTEON_REMOTE_PROTOCOL*
environment variable is set, the BDK can be booted on the board.  Issue
the following *bdk-remote* command.

[source, sh]
----
bdk-remote boot target-bin/bdk-boot.bin
----

